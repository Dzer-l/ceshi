{"remainingRequest":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/thread-loader/dist/cjs.js!/home/jenkins_data/workspace/页面-公证处后台/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/home/jenkins_data/workspace/页面-公证处后台/node_modules/element-ui/lib/select.js","dependencies":[{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/element-ui/lib/select.js","mtime":499162500000},{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7ICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9Cgptb2R1bGUuZXhwb3J0cyA9Ci8qKioqKiovCmZ1bmN0aW9uIChtb2R1bGVzKSB7CiAgLy8gd2VicGFja0Jvb3RzdHJhcAoKICAvKioqKioqLwogIC8vIFRoZSBtb2R1bGUgY2FjaGUKCiAgLyoqKioqKi8KICB2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb24KCiAgLyoqKioqKi8KCiAgZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgLyoqKioqKi8KCiAgICAvKioqKioqLwogICAgLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCgogICAgLyoqKioqKi8KICAgIGlmIChpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkgewogICAgICAvKioqKioqLwogICAgICByZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKICAgICAgLyoqKioqKi8KICAgIH0KICAgIC8qKioqKiovCiAgICAvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKQoKICAgIC8qKioqKiovCgoKICAgIHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHsKICAgICAgLyoqKioqKi8KICAgICAgaTogbW9kdWxlSWQsCgogICAgICAvKioqKioqLwogICAgICBsOiBmYWxzZSwKCiAgICAgIC8qKioqKiovCiAgICAgIGV4cG9ydHM6IHt9CiAgICAgIC8qKioqKiovCgogICAgfTsKICAgIC8qKioqKiovCgogICAgLyoqKioqKi8KICAgIC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgoKICAgIC8qKioqKiovCgogICAgbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CiAgICAvKioqKioqLwoKICAgIC8qKioqKiovCiAgICAvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkCgogICAgLyoqKioqKi8KCiAgICBtb2R1bGUubCA9IHRydWU7CiAgICAvKioqKioqLwoKICAgIC8qKioqKiovCiAgICAvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQoKICAgIC8qKioqKiovCgogICAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgLyoqKioqKi8KICB9CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQoKICAvKioqKioqLwoKCiAgX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlczsKICAvKioqKioqLwoKICAvKioqKioqLwogIC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlCgogIC8qKioqKiovCgogIF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHMKCiAgLyoqKioqKi8KCiAgX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24gKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewogICAgLyoqKioqKi8KICAgIGlmICghX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7CiAgICAgIC8qKioqKiovCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGdldHRlcgogICAgICB9KTsKICAgICAgLyoqKioqKi8KICAgIH0KICAgIC8qKioqKiovCgogIH07CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzCgogIC8qKioqKiovCgoKICBfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbiAoZXhwb3J0cykgewogICAgLyoqKioqKi8KICAgIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHsKICAgICAgLyoqKioqKi8KICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgewogICAgICAgIHZhbHVlOiAnTW9kdWxlJwogICAgICB9KTsKICAgICAgLyoqKioqKi8KICAgIH0KICAgIC8qKioqKiovCgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgLyoqKioqKi8KICB9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0CgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0CgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zCgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0CgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZQoKICAvKioqKioqLwoKCiAgX193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24gKHZhbHVlLCBtb2RlKSB7CiAgICAvKioqKioqLwogICAgaWYgKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpOwogICAgLyoqKioqKi8KCiAgICBpZiAobW9kZSAmIDgpIHJldHVybiB2YWx1ZTsKICAgIC8qKioqKiovCgogICAgaWYgKG1vZGUgJiA0ICYmIF90eXBlb2YyKHZhbHVlKSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlOwogICAgLyoqKioqKi8KCiAgICB2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgLyoqKioqKi8KCiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpOwogICAgLyoqKioqKi8KCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IHZhbHVlCiAgICB9KTsKICAgIC8qKioqKiovCgogICAgaWYgKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcmV0dXJuIHZhbHVlW2tleV07CiAgICAgIH0uYmluZChudWxsLCBrZXkpKTsKICAgIH0KICAgIC8qKioqKiovCgogICAgcmV0dXJuIG5zOwogICAgLyoqKioqKi8KICB9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXMKCiAgLyoqKioqKi8KCgogIF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgIC8qKioqKiovCiAgICB2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8KICAgIC8qKioqKiovCiAgICBmdW5jdGlvbiBnZXREZWZhdWx0KCkgewogICAgICByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107CiAgICB9IDoKICAgIC8qKioqKiovCiAgICBmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgewogICAgICByZXR1cm4gbW9kdWxlOwogICAgfTsKICAgIC8qKioqKiovCgogICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOwogICAgLyoqKioqKi8KCgogICAgcmV0dXJuIGdldHRlcjsKICAgIC8qKioqKiovCiAgfTsKICAvKioqKioqLwoKICAvKioqKioqLwogIC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbAoKICAvKioqKioqLwoKCiAgX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24gKG9iamVjdCwgcHJvcGVydHkpIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7CiAgfTsKICAvKioqKioqLwoKICAvKioqKioqLwogIC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fCgogIC8qKioqKiovCgoKICBfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiL2Rpc3QvIjsKICAvKioqKioqLwoKICAvKioqKioqLwoKICAvKioqKioqLwogIC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwoKICAvKioqKioqLwoKICByZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA2MSk7CiAgLyoqKioqKi8KfQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKLyoqKioqKi8KKFsKICAvKiAxICovCgogIC8qIDIgKi8KCiAgLyogNyAqLwoKICAvKiA4ICovCgogIC8qIDkgKi8KCiAgLyogMTEgKi8KCiAgLyogMTMgKi8KCiAgLyogMTUgKi8KCiAgLyogMTggKi8KCiAgLyogMjAgKi8KCiAgLyogMjMgKi8KCiAgLyogMjQgKi8KCiAgLyogMjUgKi8KCiAgLyogMjYgKi8KCiAgLyogMjcgKi8KCiAgLyogMjggKi8KCiAgLyogMjkgKi8KCiAgLyogMzAgKi8KCiAgLyogMzIgKi8KCiAgLyogMzMgKi8KCiAgLyogMzUgKi8KCiAgLyogMzYgKi8KCiAgLyogMzcgKi8KCiAgLyogMzkgKi8KCiAgLyogNDAgKi8KCiAgLyogNDEgKi8KCiAgLyogNDIgKi8KCiAgLyogNDMgKi8KCiAgLyogNDQgKi8KCiAgLyogNDUgKi8KCiAgLyogNDYgKi8KCiAgLyogNDcgKi8KCiAgLyogNDggKi8KCiAgLyogNDkgKi8KCiAgLyogNTAgKi8KCiAgLyogNTEgKi8KCiAgLyogNTIgKi8KCiAgLyogNTMgKi8KCiAgLyogNTQgKi8KCiAgLyogNTUgKi8KCiAgLyogNTYgKi8KCiAgLyogNTcgKi8KCiAgLyogNTggKi8KCiAgLyogNTkgKi8KCiAgLyogNjAgKi8KCi8qIDAgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAidXNlIHN0cmljdCI7CiAgLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovCgogIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiYSIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBub3JtYWxpemVDb21wb25lbnQ7CiAgfSk7CiAgLyogZ2xvYmFscyBfX1ZVRV9TU1JfQ09OVEVYVF9fICovCiAgLy8gSU1QT1JUQU5UOiBEbyBOT1QgdXNlIEVTMjAxNSBmZWF0dXJlcyBpbiB0aGlzIGZpbGUgKGV4Y2VwdCBmb3IgbW9kdWxlcykuCiAgLy8gVGhpcyBtb2R1bGUgaXMgYSBydW50aW1lIHV0aWxpdHkgZm9yIGNsZWFuZXIgY29tcG9uZW50IG1vZHVsZSBvdXRwdXQgYW5kIHdpbGwKICAvLyBiZSBpbmNsdWRlZCBpbiB0aGUgZmluYWwgd2VicGFjayB1c2VyIGJ1bmRsZS4KCgogIGZ1bmN0aW9uIG5vcm1hbGl6ZUNvbXBvbmVudChzY3JpcHRFeHBvcnRzLCByZW5kZXIsIHN0YXRpY1JlbmRlckZucywgZnVuY3Rpb25hbFRlbXBsYXRlLCBpbmplY3RTdHlsZXMsIHNjb3BlSWQsIG1vZHVsZUlkZW50aWZpZXIsCiAgLyogc2VydmVyIG9ubHkgKi8KICBzaGFkb3dNb2RlCiAgLyogdnVlLWNsaSBvbmx5ICovCiAgKSB7CiAgICAvLyBWdWUuZXh0ZW5kIGNvbnN0cnVjdG9yIGV4cG9ydCBpbnRlcm9wCiAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBzY3JpcHRFeHBvcnRzID09PSAnZnVuY3Rpb24nID8gc2NyaXB0RXhwb3J0cy5vcHRpb25zIDogc2NyaXB0RXhwb3J0czsgLy8gcmVuZGVyIGZ1bmN0aW9ucwoKICAgIGlmIChyZW5kZXIpIHsKICAgICAgb3B0aW9ucy5yZW5kZXIgPSByZW5kZXI7CiAgICAgIG9wdGlvbnMuc3RhdGljUmVuZGVyRm5zID0gc3RhdGljUmVuZGVyRm5zOwogICAgICBvcHRpb25zLl9jb21waWxlZCA9IHRydWU7CiAgICB9IC8vIGZ1bmN0aW9uYWwgdGVtcGxhdGUKCgogICAgaWYgKGZ1bmN0aW9uYWxUZW1wbGF0ZSkgewogICAgICBvcHRpb25zLmZ1bmN0aW9uYWwgPSB0cnVlOwogICAgfSAvLyBzY29wZWRJZAoKCiAgICBpZiAoc2NvcGVJZCkgewogICAgICBvcHRpb25zLl9zY29wZUlkID0gJ2RhdGEtdi0nICsgc2NvcGVJZDsKICAgIH0KCiAgICB2YXIgaG9vazsKCiAgICBpZiAobW9kdWxlSWRlbnRpZmllcikgewogICAgICAvLyBzZXJ2ZXIgYnVpbGQKICAgICAgaG9vayA9IGZ1bmN0aW9uIGhvb2soY29udGV4dCkgewogICAgICAgIC8vIDIuMyBpbmplY3Rpb24KICAgICAgICBjb250ZXh0ID0gY29udGV4dCB8fCAvLyBjYWNoZWQgY2FsbAogICAgICAgIHRoaXMuJHZub2RlICYmIHRoaXMuJHZub2RlLnNzckNvbnRleHQgfHwgLy8gc3RhdGVmdWwKICAgICAgICB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC4kdm5vZGUgJiYgdGhpcy5wYXJlbnQuJHZub2RlLnNzckNvbnRleHQ7IC8vIGZ1bmN0aW9uYWwKICAgICAgICAvLyAyLjIgd2l0aCBydW5Jbk5ld0NvbnRleHQ6IHRydWUKCiAgICAgICAgaWYgKCFjb250ZXh0ICYmIHR5cGVvZiBfX1ZVRV9TU1JfQ09OVEVYVF9fICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgY29udGV4dCA9IF9fVlVFX1NTUl9DT05URVhUX187CiAgICAgICAgfSAvLyBpbmplY3QgY29tcG9uZW50IHN0eWxlcwoKCiAgICAgICAgaWYgKGluamVjdFN0eWxlcykgewogICAgICAgICAgaW5qZWN0U3R5bGVzLmNhbGwodGhpcywgY29udGV4dCk7CiAgICAgICAgfSAvLyByZWdpc3RlciBjb21wb25lbnQgbW9kdWxlIGlkZW50aWZpZXIgZm9yIGFzeW5jIGNodW5rIGluZmVycmVuY2UKCgogICAgICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQuX3JlZ2lzdGVyZWRDb21wb25lbnRzKSB7CiAgICAgICAgICBjb250ZXh0Ll9yZWdpc3RlcmVkQ29tcG9uZW50cy5hZGQobW9kdWxlSWRlbnRpZmllcik7CiAgICAgICAgfQogICAgICB9OyAvLyB1c2VkIGJ5IHNzciBpbiBjYXNlIGNvbXBvbmVudCBpcyBjYWNoZWQgYW5kIGJlZm9yZUNyZWF0ZQogICAgICAvLyBuZXZlciBnZXRzIGNhbGxlZAoKCiAgICAgIG9wdGlvbnMuX3NzclJlZ2lzdGVyID0gaG9vazsKICAgIH0gZWxzZSBpZiAoaW5qZWN0U3R5bGVzKSB7CiAgICAgIGhvb2sgPSBzaGFkb3dNb2RlID8gZnVuY3Rpb24gKCkgewogICAgICAgIGluamVjdFN0eWxlcy5jYWxsKHRoaXMsIHRoaXMuJHJvb3QuJG9wdGlvbnMuc2hhZG93Um9vdCk7CiAgICAgIH0gOiBpbmplY3RTdHlsZXM7CiAgICB9CgogICAgaWYgKGhvb2spIHsKICAgICAgaWYgKG9wdGlvbnMuZnVuY3Rpb25hbCkgewogICAgICAgIC8vIGZvciB0ZW1wbGF0ZS1vbmx5IGhvdC1yZWxvYWQgYmVjYXVzZSBpbiB0aGF0IGNhc2UgdGhlIHJlbmRlciBmbiBkb2Vzbid0CiAgICAgICAgLy8gZ28gdGhyb3VnaCB0aGUgbm9ybWFsaXplcgogICAgICAgIG9wdGlvbnMuX2luamVjdFN0eWxlcyA9IGhvb2s7IC8vIHJlZ2lzdGVyIGZvciBmdW5jdGlvYWwgY29tcG9uZW50IGluIHZ1ZSBmaWxlCgogICAgICAgIHZhciBvcmlnaW5hbFJlbmRlciA9IG9wdGlvbnMucmVuZGVyOwoKICAgICAgICBvcHRpb25zLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcldpdGhTdHlsZUluamVjdGlvbihoLCBjb250ZXh0KSB7CiAgICAgICAgICBob29rLmNhbGwoY29udGV4dCk7CiAgICAgICAgICByZXR1cm4gb3JpZ2luYWxSZW5kZXIoaCwgY29udGV4dCk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBpbmplY3QgY29tcG9uZW50IHJlZ2lzdHJhdGlvbiBhcyBiZWZvcmVDcmVhdGUgaG9vawogICAgICAgIHZhciBleGlzdGluZyA9IG9wdGlvbnMuYmVmb3JlQ3JlYXRlOwogICAgICAgIG9wdGlvbnMuYmVmb3JlQ3JlYXRlID0gZXhpc3RpbmcgPyBbXS5jb25jYXQoZXhpc3RpbmcsIGhvb2spIDogW2hvb2tdOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgZXhwb3J0czogc2NyaXB0RXhwb3J0cywKICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgfTsKICB9CiAgLyoqKi8KCn0sLCwKLyogMyAqLwoKLyoqKi8KZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZWxlbWVudC11aS9saWIvdXRpbHMvdXRpbCIpOwogIC8qKiovCn0sCi8qIDQgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL21peGlucy9lbWl0dGVyIik7CiAgLyoqKi8KfSwKLyogNSAqLwoKLyoqKi8KZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZWxlbWVudC11aS9saWIvdXRpbHMvdnVlLXBvcHBlciIpOwogIC8qKiovCn0sCi8qIDYgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL21peGlucy9sb2NhbGUiKTsKICAvKioqLwp9LCwsLAovKiAxMCAqLwoKLyoqKi8KZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZWxlbWVudC11aS9saWIvaW5wdXQiKTsKICAvKioqLwp9LCwKLyogMTIgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL3V0aWxzL2NsaWNrb3V0c2lkZSIpOwogIC8qKiovCn0sLAovKiAxNCAqLwoKLyoqKi8KZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZWxlbWVudC11aS9saWIvc2Nyb2xsYmFyIik7CiAgLyoqKi8KfSwsCi8qIDE2ICovCgovKioqLwpmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJlbGVtZW50LXVpL2xpYi91dGlscy9yZXNpemUtZXZlbnQiKTsKICAvKioqLwp9LAovKiAxNyAqLwoKLyoqKi8KZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgidGhyb3R0bGUtZGVib3VuY2UvZGVib3VuY2UiKTsKICAvKioqLwp9LCwKLyogMTkgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL2xvY2FsZSIpOwogIC8qKiovCn0sLAovKiAyMSAqLwoKLyoqKi8KZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZWxlbWVudC11aS9saWIvdXRpbHMvc2hhcmVkIik7CiAgLyoqKi8KfSwKLyogMjIgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL21peGlucy9mb2N1cyIpOwogIC8qKiovCn0sLCwsLCwsLCwKLyogMzEgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL3V0aWxzL3Njcm9sbC1pbnRvLXZpZXciKTsKICAvKioqLwp9LCwsCi8qIDM0ICovCgovKioqLwpmdW5jdGlvbiAobW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgInVzZSBzdHJpY3QiOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYi9sb2FkZXJzL3RlbXBsYXRlTG9hZGVyLmpzPz92dWUtbG9hZGVyLW9wdGlvbnMhLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWI/P3Z1ZS1sb2FkZXItb3B0aW9ucyEuL3BhY2thZ2VzL3NlbGVjdC9zcmMvb3B0aW9uLnZ1ZT92dWUmdHlwZT10ZW1wbGF0ZSZpZD03YTQ0YzY0MiYKCiAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgIHZhciBfdm0gPSB0aGlzOwoKICAgIHZhciBfaCA9IF92bS4kY3JlYXRlRWxlbWVudDsKCiAgICB2YXIgX2MgPSBfdm0uX3NlbGYuX2MgfHwgX2g7CgogICAgcmV0dXJuIF9jKCJsaSIsIHsKICAgICAgZGlyZWN0aXZlczogW3sKICAgICAgICBuYW1lOiAic2hvdyIsCiAgICAgICAgcmF3TmFtZTogInYtc2hvdyIsCiAgICAgICAgdmFsdWU6IF92bS52aXNpYmxlLAogICAgICAgIGV4cHJlc3Npb246ICJ2aXNpYmxlIgogICAgICB9XSwKICAgICAgc3RhdGljQ2xhc3M6ICJlbC1zZWxlY3QtZHJvcGRvd25fX2l0ZW0iLAogICAgICBjbGFzczogewogICAgICAgIHNlbGVjdGVkOiBfdm0uaXRlbVNlbGVjdGVkLAogICAgICAgICJpcy1kaXNhYmxlZCI6IF92bS5kaXNhYmxlZCB8fCBfdm0uZ3JvdXBEaXNhYmxlZCB8fCBfdm0ubGltaXRSZWFjaGVkLAogICAgICAgIGhvdmVyOiBfdm0uaG92ZXIKICAgICAgfSwKICAgICAgb246IHsKICAgICAgICBtb3VzZWVudGVyOiBfdm0uaG92ZXJJdGVtLAogICAgICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljaygkZXZlbnQpIHsKICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIHJldHVybiBfdm0uc2VsZWN0T3B0aW9uQ2xpY2soJGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIFtfdm0uX3QoImRlZmF1bHQiLCBbX2MoInNwYW4iLCBbX3ZtLl92KF92bS5fcyhfdm0uY3VycmVudExhYmVsKSldKV0pXSwgMik7CiAgfTsKCiAgdmFyIHN0YXRpY1JlbmRlckZucyA9IFtdOwogIHJlbmRlci5fd2l0aFN0cmlwcGVkID0gdHJ1ZTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9zZWxlY3Qvc3JjL29wdGlvbi52dWU/dnVlJnR5cGU9dGVtcGxhdGUmaWQ9N2E0NGM2NDImCiAgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvbWl4aW5zL2VtaXR0ZXIiCgogIHZhciBlbWl0dGVyXyA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CgogIHZhciBlbWl0dGVyX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGVtaXR0ZXJfKTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvdXRpbHMvdXRpbCIKCgogIHZhciB1dGlsXyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2JhYmVsLWxvYWRlci9saWIhLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWI/P3Z1ZS1sb2FkZXItb3B0aW9ucyEuL3BhY2thZ2VzL3NlbGVjdC9zcmMvb3B0aW9uLnZ1ZT92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyYKCgogIHZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsKICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogIH0gOiBmdW5jdGlvbiAob2JqKSB7CiAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMihvYmopOwogIH07IC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KCiAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgdmFyIG9wdGlvbnZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXyA9IHsKICAgIG1peGluczogW2VtaXR0ZXJfZGVmYXVsdC5hXSwKICAgIG5hbWU6ICdFbE9wdGlvbicsCiAgICBjb21wb25lbnROYW1lOiAnRWxPcHRpb24nLAogICAgaW5qZWN0OiBbJ3NlbGVjdCddLAogICAgcHJvcHM6IHsKICAgICAgdmFsdWU6IHsKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICB9LAogICAgICBsYWJlbDogW1N0cmluZywgTnVtYmVyXSwKICAgICAgY3JlYXRlZDogQm9vbGVhbiwKICAgICAgZGlzYWJsZWQ6IHsKICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgIH0KICAgIH0sCiAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgICByZXR1cm4gewogICAgICAgIGluZGV4OiAtMSwKICAgICAgICBncm91cERpc2FibGVkOiBmYWxzZSwKICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgIGhpdFN0YXRlOiBmYWxzZSwKICAgICAgICBob3ZlcjogZmFsc2UKICAgICAgfTsKICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICBpc09iamVjdDogZnVuY3Rpb24gaXNPYmplY3QoKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGlzLnZhbHVlKS50b0xvd2VyQ2FzZSgpID09PSAnW29iamVjdCBvYmplY3RdJzsKICAgICAgfSwKICAgICAgY3VycmVudExhYmVsOiBmdW5jdGlvbiBjdXJyZW50TGFiZWwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFiZWwgfHwgKHRoaXMuaXNPYmplY3QgPyAnJyA6IHRoaXMudmFsdWUpOwogICAgICB9LAogICAgICBjdXJyZW50VmFsdWU6IGZ1bmN0aW9uIGN1cnJlbnRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy52YWx1ZSB8fCB0aGlzLmxhYmVsIHx8ICcnOwogICAgICB9LAogICAgICBpdGVtU2VsZWN0ZWQ6IGZ1bmN0aW9uIGl0ZW1TZWxlY3RlZCgpIHsKICAgICAgICBpZiAoIXRoaXMuc2VsZWN0Lm11bHRpcGxlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5pc0VxdWFsKHRoaXMudmFsdWUsIHRoaXMuc2VsZWN0LnZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbnModGhpcy5zZWxlY3QudmFsdWUsIHRoaXMudmFsdWUpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGltaXRSZWFjaGVkOiBmdW5jdGlvbiBsaW1pdFJlYWNoZWQoKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0Lm11bHRpcGxlKSB7CiAgICAgICAgICByZXR1cm4gIXRoaXMuaXRlbVNlbGVjdGVkICYmICh0aGlzLnNlbGVjdC52YWx1ZSB8fCBbXSkubGVuZ3RoID49IHRoaXMuc2VsZWN0Lm11bHRpcGxlTGltaXQgJiYgdGhpcy5zZWxlY3QubXVsdGlwbGVMaW1pdCA+IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB3YXRjaDogewogICAgICBjdXJyZW50TGFiZWw6IGZ1bmN0aW9uIGN1cnJlbnRMYWJlbCgpIHsKICAgICAgICBpZiAoIXRoaXMuY3JlYXRlZCAmJiAhdGhpcy5zZWxlY3QucmVtb3RlKSB0aGlzLmRpc3BhdGNoKCdFbFNlbGVjdCcsICdzZXRTZWxlY3RlZCcpOwogICAgICB9LAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUodmFsLCBvbGRWYWwpIHsKICAgICAgICB2YXIgX3NlbGVjdCA9IHRoaXMuc2VsZWN0LAogICAgICAgICAgICByZW1vdGUgPSBfc2VsZWN0LnJlbW90ZSwKICAgICAgICAgICAgdmFsdWVLZXkgPSBfc2VsZWN0LnZhbHVlS2V5OwoKICAgICAgICBpZiAoIXRoaXMuY3JlYXRlZCAmJiAhcmVtb3RlKSB7CiAgICAgICAgICBpZiAodmFsdWVLZXkgJiYgKHR5cGVvZiB2YWwgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbCkpID09PSAnb2JqZWN0JyAmJiAodHlwZW9mIG9sZFZhbCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2Yob2xkVmFsKSkgPT09ICdvYmplY3QnICYmIHZhbFt2YWx1ZUtleV0gPT09IG9sZFZhbFt2YWx1ZUtleV0pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2goJ0VsU2VsZWN0JywgJ3NldFNlbGVjdGVkJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICBpc0VxdWFsOiBmdW5jdGlvbiBpc0VxdWFsKGEsIGIpIHsKICAgICAgICBpZiAoIXRoaXMuaXNPYmplY3QpIHsKICAgICAgICAgIHJldHVybiBhID09PSBiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgdmFsdWVLZXkgPSB0aGlzLnNlbGVjdC52YWx1ZUtleTsKICAgICAgICAgIHJldHVybiBPYmplY3QodXRpbF9bImdldFZhbHVlQnlQYXRoIl0pKGEsIHZhbHVlS2V5KSA9PT0gT2JqZWN0KHV0aWxfWyJnZXRWYWx1ZUJ5UGF0aCJdKShiLCB2YWx1ZUtleSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjb250YWluczogZnVuY3Rpb24gY29udGFpbnMoKSB7CiAgICAgICAgdmFyIGFyciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgICAgICAgdmFyIHRhcmdldCA9IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgaWYgKCF0aGlzLmlzT2JqZWN0KSB7CiAgICAgICAgICByZXR1cm4gYXJyICYmIGFyci5pbmRleE9mKHRhcmdldCkgPiAtMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHZhbHVlS2V5ID0gdGhpcy5zZWxlY3QudmFsdWVLZXk7CiAgICAgICAgICByZXR1cm4gYXJyICYmIGFyci5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QodXRpbF9bImdldFZhbHVlQnlQYXRoIl0pKGl0ZW0sIHZhbHVlS2V5KSA9PT0gT2JqZWN0KHV0aWxfWyJnZXRWYWx1ZUJ5UGF0aCJdKSh0YXJnZXQsIHZhbHVlS2V5KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaGFuZGxlR3JvdXBEaXNhYmxlZDogZnVuY3Rpb24gaGFuZGxlR3JvdXBEaXNhYmxlZCh2YWwpIHsKICAgICAgICB0aGlzLmdyb3VwRGlzYWJsZWQgPSB2YWw7CiAgICAgIH0sCiAgICAgIGhvdmVySXRlbTogZnVuY3Rpb24gaG92ZXJJdGVtKCkgewogICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiAhdGhpcy5ncm91cERpc2FibGVkKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdC5ob3ZlckluZGV4ID0gdGhpcy5zZWxlY3Qub3B0aW9ucy5pbmRleE9mKHRoaXMpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2VsZWN0T3B0aW9uQ2xpY2s6IGZ1bmN0aW9uIHNlbGVjdE9wdGlvbkNsaWNrKCkgewogICAgICAgIGlmICh0aGlzLmRpc2FibGVkICE9PSB0cnVlICYmIHRoaXMuZ3JvdXBEaXNhYmxlZCAhPT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5kaXNwYXRjaCgnRWxTZWxlY3QnLCAnaGFuZGxlT3B0aW9uQ2xpY2snLCBbdGhpcywgdHJ1ZV0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcXVlcnlDaGFuZ2U6IGZ1bmN0aW9uIHF1ZXJ5Q2hhbmdlKHF1ZXJ5KSB7CiAgICAgICAgdGhpcy52aXNpYmxlID0gbmV3IFJlZ0V4cChPYmplY3QodXRpbF9bImVzY2FwZVJlZ2V4cFN0cmluZyJdKShxdWVyeSksICdpJykudGVzdCh0aGlzLmN1cnJlbnRMYWJlbCkgfHwgdGhpcy5jcmVhdGVkOwoKICAgICAgICBpZiAoIXRoaXMudmlzaWJsZSkgewogICAgICAgICAgdGhpcy5zZWxlY3QuZmlsdGVyZWRPcHRpb25zQ291bnQtLTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgICB0aGlzLnNlbGVjdC5vcHRpb25zLnB1c2godGhpcyk7CiAgICAgIHRoaXMuc2VsZWN0LmNhY2hlZE9wdGlvbnMucHVzaCh0aGlzKTsKICAgICAgdGhpcy5zZWxlY3Qub3B0aW9uc0NvdW50Kys7CiAgICAgIHRoaXMuc2VsZWN0LmZpbHRlcmVkT3B0aW9uc0NvdW50Kys7CiAgICAgIHRoaXMuJG9uKCdxdWVyeUNoYW5nZScsIHRoaXMucXVlcnlDaGFuZ2UpOwogICAgICB0aGlzLiRvbignaGFuZGxlR3JvdXBEaXNhYmxlZCcsIHRoaXMuaGFuZGxlR3JvdXBEaXNhYmxlZCk7CiAgICB9LAogICAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgICAgdmFyIF9zZWxlY3QyID0gdGhpcy5zZWxlY3QsCiAgICAgICAgICBzZWxlY3RlZCA9IF9zZWxlY3QyLnNlbGVjdGVkLAogICAgICAgICAgbXVsdGlwbGUgPSBfc2VsZWN0Mi5tdWx0aXBsZTsKICAgICAgdmFyIHNlbGVjdGVkT3B0aW9ucyA9IG11bHRpcGxlID8gc2VsZWN0ZWQgOiBbc2VsZWN0ZWRdOwogICAgICB2YXIgaW5kZXggPSB0aGlzLnNlbGVjdC5jYWNoZWRPcHRpb25zLmluZGV4T2YodGhpcyk7CiAgICAgIHZhciBzZWxlY3RlZEluZGV4ID0gc2VsZWN0ZWRPcHRpb25zLmluZGV4T2YodGhpcyk7IC8vIGlmIG9wdGlvbiBpcyBub3Qgc2VsZWN0ZWQsIHJlbW92ZSBpdCBmcm9tIGNhY2hlCgogICAgICBpZiAoaW5kZXggPiAtMSAmJiBzZWxlY3RlZEluZGV4IDwgMCkgewogICAgICAgIHRoaXMuc2VsZWN0LmNhY2hlZE9wdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3Qub25PcHRpb25EZXN0cm95KHRoaXMuc2VsZWN0Lm9wdGlvbnMuaW5kZXhPZih0aGlzKSk7CiAgICB9CiAgfTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9zZWxlY3Qvc3JjL29wdGlvbi52dWU/dnVlJnR5cGU9c2NyaXB0Jmxhbmc9anMmCgogIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCiAgdmFyIHNyY19vcHRpb252dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18gPSBvcHRpb252dWVfdHlwZV9zY3JpcHRfbGFuZ19qc187IC8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWIvcnVudGltZS9jb21wb25lbnROb3JtYWxpemVyLmpzCgogIHZhciBjb21wb25lbnROb3JtYWxpemVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9zZWxlY3Qvc3JjL29wdGlvbi52dWUKCiAgLyogbm9ybWFsaXplIGNvbXBvbmVudCAqLwoKCiAgdmFyIGNvbXBvbmVudCA9IE9iamVjdChjb21wb25lbnROb3JtYWxpemVyWyJhIgogIC8qIGRlZmF1bHQgKi8KICBdKShzcmNfb3B0aW9udnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfLCByZW5kZXIsIHN0YXRpY1JlbmRlckZucywgZmFsc2UsIG51bGwsIG51bGwsIG51bGwpOwogIC8qIGhvdCByZWxvYWQgKi8KCiAgaWYgKGZhbHNlKSB7CiAgICB2YXIgYXBpOwogIH0KCiAgY29tcG9uZW50Lm9wdGlvbnMuX19maWxlID0gInBhY2thZ2VzL3NlbGVjdC9zcmMvb3B0aW9uLnZ1ZSI7CiAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKICB2YXIgc3JjX29wdGlvbiA9IF9fd2VicGFja19leHBvcnRzX19bImEiXSA9IGNvbXBvbmVudC5leHBvcnRzOwogIC8qKiovCn0sLCwsCi8qIDM4ICovCgovKioqLwpmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJlbGVtZW50LXVpL2xpYi90YWciKTsKICAvKioqLwp9LCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwKLyogNjEgKi8KCi8qKiovCmZ1bmN0aW9uIChtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAidXNlIHN0cmljdCI7CgogIF9fd2VicGFja19yZXF1aXJlX18ucihfX3dlYnBhY2tfZXhwb3J0c19fKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWIvbG9hZGVycy90ZW1wbGF0ZUxvYWRlci5qcz8/dnVlLWxvYWRlci1vcHRpb25zIS4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliPz92dWUtbG9hZGVyLW9wdGlvbnMhLi9wYWNrYWdlcy9zZWxlY3Qvc3JjL3NlbGVjdC52dWU/dnVlJnR5cGU9dGVtcGxhdGUmaWQ9MGU0YWFkZTYmCgoKICB2YXIgcmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkgewogICAgdmFyIF92bSA9IHRoaXM7CgogICAgdmFyIF9oID0gX3ZtLiRjcmVhdGVFbGVtZW50OwoKICAgIHZhciBfYyA9IF92bS5fc2VsZi5fYyB8fCBfaDsKCiAgICByZXR1cm4gX2MoImRpdiIsIHsKICAgICAgZGlyZWN0aXZlczogW3sKICAgICAgICBuYW1lOiAiY2xpY2tvdXRzaWRlIiwKICAgICAgICByYXdOYW1lOiAidi1jbGlja291dHNpZGUiLAogICAgICAgIHZhbHVlOiBfdm0uaGFuZGxlQ2xvc2UsCiAgICAgICAgZXhwcmVzc2lvbjogImhhbmRsZUNsb3NlIgogICAgICB9XSwKICAgICAgc3RhdGljQ2xhc3M6ICJlbC1zZWxlY3QiLAogICAgICBjbGFzczogW192bS5zZWxlY3RTaXplID8gImVsLXNlbGVjdC0tIiArIF92bS5zZWxlY3RTaXplIDogIiJdLAogICAgICBvbjogewogICAgICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljaygkZXZlbnQpIHsKICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIHJldHVybiBfdm0udG9nZ2xlTWVudSgkZXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgW192bS5tdWx0aXBsZSA/IF9jKCJkaXYiLCB7CiAgICAgIHJlZjogInRhZ3MiLAogICAgICBzdGF0aWNDbGFzczogImVsLXNlbGVjdF9fdGFncyIsCiAgICAgIHN0eWxlOiB7CiAgICAgICAgIm1heC13aWR0aCI6IF92bS5pbnB1dFdpZHRoIC0gMzIgKyAicHgiLAogICAgICAgIHdpZHRoOiAiMTAwJSIKICAgICAgfQogICAgfSwgW192bS5jb2xsYXBzZVRhZ3MgJiYgX3ZtLnNlbGVjdGVkLmxlbmd0aCA/IF9jKCJzcGFuIiwgW19jKCJlbC10YWciLCB7CiAgICAgIGF0dHJzOiB7CiAgICAgICAgY2xvc2FibGU6ICFfdm0uc2VsZWN0RGlzYWJsZWQsCiAgICAgICAgc2l6ZTogX3ZtLmNvbGxhcHNlVGFnU2l6ZSwKICAgICAgICBoaXQ6IF92bS5zZWxlY3RlZFswXS5oaXRTdGF0ZSwKICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgImRpc2FibGUtdHJhbnNpdGlvbnMiOiAiIgogICAgICB9LAogICAgICBvbjogewogICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgkZXZlbnQpIHsKICAgICAgICAgIF92bS5kZWxldGVUYWcoJGV2ZW50LCBfdm0uc2VsZWN0ZWRbMF0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwgW19jKCJzcGFuIiwgewogICAgICBzdGF0aWNDbGFzczogImVsLXNlbGVjdF9fdGFncy10ZXh0IgogICAgfSwgW192bS5fdihfdm0uX3MoX3ZtLnNlbGVjdGVkWzBdLmN1cnJlbnRMYWJlbCkpXSldKSwgX3ZtLnNlbGVjdGVkLmxlbmd0aCA+IDEgPyBfYygiZWwtdGFnIiwgewogICAgICBhdHRyczogewogICAgICAgIGNsb3NhYmxlOiBmYWxzZSwKICAgICAgICBzaXplOiBfdm0uY29sbGFwc2VUYWdTaXplLAogICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAiZGlzYWJsZS10cmFuc2l0aW9ucyI6ICIiCiAgICAgIH0KICAgIH0sIFtfYygic3BhbiIsIHsKICAgICAgc3RhdGljQ2xhc3M6ICJlbC1zZWxlY3RfX3RhZ3MtdGV4dCIKICAgIH0sIFtfdm0uX3YoIisgIiArIF92bS5fcyhfdm0uc2VsZWN0ZWQubGVuZ3RoIC0gMSkpXSldKSA6IF92bS5fZSgpXSwgMSkgOiBfdm0uX2UoKSwgIV92bS5jb2xsYXBzZVRhZ3MgPyBfYygidHJhbnNpdGlvbi1ncm91cCIsIHsKICAgICAgb246IHsKICAgICAgICAiYWZ0ZXItbGVhdmUiOiBfdm0ucmVzZXRJbnB1dEhlaWdodAogICAgICB9CiAgICB9LCBfdm0uX2woX3ZtLnNlbGVjdGVkLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICByZXR1cm4gX2MoImVsLXRhZyIsIHsKICAgICAgICBrZXk6IF92bS5nZXRWYWx1ZUtleShpdGVtKSwKICAgICAgICBhdHRyczogewogICAgICAgICAgY2xvc2FibGU6ICFfdm0uc2VsZWN0RGlzYWJsZWQsCiAgICAgICAgICBzaXplOiBfdm0uY29sbGFwc2VUYWdTaXplLAogICAgICAgICAgaGl0OiBpdGVtLmhpdFN0YXRlLAogICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgImRpc2FibGUtdHJhbnNpdGlvbnMiOiAiIgogICAgICAgIH0sCiAgICAgICAgb246IHsKICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgkZXZlbnQpIHsKICAgICAgICAgICAgX3ZtLmRlbGV0ZVRhZygkZXZlbnQsIGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgW19jKCJzcGFuIiwgewogICAgICAgIHN0YXRpY0NsYXNzOiAiZWwtc2VsZWN0X190YWdzLXRleHQiCiAgICAgIH0sIFtfdm0uX3YoX3ZtLl9zKGl0ZW0uY3VycmVudExhYmVsKSldKV0pOwogICAgfSksIDEpIDogX3ZtLl9lKCksIF92bS5maWx0ZXJhYmxlID8gX2MoImlucHV0IiwgewogICAgICBkaXJlY3RpdmVzOiBbewogICAgICAgIG5hbWU6ICJtb2RlbCIsCiAgICAgICAgcmF3TmFtZTogInYtbW9kZWwiLAogICAgICAgIHZhbHVlOiBfdm0ucXVlcnksCiAgICAgICAgZXhwcmVzc2lvbjogInF1ZXJ5IgogICAgICB9XSwKICAgICAgcmVmOiAiaW5wdXQiLAogICAgICBzdGF0aWNDbGFzczogImVsLXNlbGVjdF9faW5wdXQiLAogICAgICBjbGFzczogW192bS5zZWxlY3RTaXplID8gImlzLSIgKyBfdm0uc2VsZWN0U2l6ZSA6ICIiXSwKICAgICAgc3R5bGU6IHsKICAgICAgICAiZmxleC1ncm93IjogIjEiLAogICAgICAgIHdpZHRoOiBfdm0uaW5wdXRMZW5ndGggLyAoX3ZtLmlucHV0V2lkdGggLSAzMikgKyAiJSIsCiAgICAgICAgIm1heC13aWR0aCI6IF92bS5pbnB1dFdpZHRoIC0gNDIgKyAicHgiCiAgICAgIH0sCiAgICAgIGF0dHJzOiB7CiAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgIGRpc2FibGVkOiBfdm0uc2VsZWN0RGlzYWJsZWQsCiAgICAgICAgYXV0b2NvbXBsZXRlOiBfdm0uYXV0b0NvbXBsZXRlIHx8IF92bS5hdXRvY29tcGxldGUKICAgICAgfSwKICAgICAgZG9tUHJvcHM6IHsKICAgICAgICB2YWx1ZTogX3ZtLnF1ZXJ5CiAgICAgIH0sCiAgICAgIG9uOiB7CiAgICAgICAgZm9jdXM6IF92bS5oYW5kbGVGb2N1cywKICAgICAgICBibHVyOiBmdW5jdGlvbiBibHVyKCRldmVudCkgewogICAgICAgICAgX3ZtLnNvZnRGb2N1cyA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAga2V5dXA6IF92bS5tYW5hZ2VQbGFjZWhvbGRlciwKICAgICAgICBrZXlkb3duOiBbX3ZtLnJlc2V0SW5wdXRTdGF0ZSwgZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgaWYgKCEoImJ1dHRvbiIgaW4gJGV2ZW50KSAmJiBfdm0uX2soJGV2ZW50LmtleUNvZGUsICJkb3duIiwgNDAsICRldmVudC5rZXksIFsiRG93biIsICJBcnJvd0Rvd24iXSkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgX3ZtLm5hdmlnYXRlT3B0aW9ucygibmV4dCIpOwogICAgICAgIH0sIGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgIGlmICghKCJidXR0b24iIGluICRldmVudCkgJiYgX3ZtLl9rKCRldmVudC5rZXlDb2RlLCAidXAiLCAzOCwgJGV2ZW50LmtleSwgWyJVcCIsICJBcnJvd1VwIl0pKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgIF92bS5uYXZpZ2F0ZU9wdGlvbnMoInByZXYiKTsKICAgICAgICB9LCBmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICBpZiAoISgiYnV0dG9uIiBpbiAkZXZlbnQpICYmIF92bS5faygkZXZlbnQua2V5Q29kZSwgImVudGVyIiwgMTMsICRldmVudC5rZXksICJFbnRlciIpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgcmV0dXJuIF92bS5zZWxlY3RPcHRpb24oJGV2ZW50KTsKICAgICAgICB9LCBmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICBpZiAoISgiYnV0dG9uIiBpbiAkZXZlbnQpICYmIF92bS5faygkZXZlbnQua2V5Q29kZSwgImVzYyIsIDI3LCAkZXZlbnQua2V5LCBbIkVzYyIsICJFc2NhcGUiXSkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBfdm0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgIH0sIGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgIGlmICghKCJidXR0b24iIGluICRldmVudCkgJiYgX3ZtLl9rKCRldmVudC5rZXlDb2RlLCAiZGVsZXRlIiwgWzgsIDQ2XSwgJGV2ZW50LmtleSwgWyJCYWNrc3BhY2UiLCAiRGVsZXRlIiwgIkRlbCJdKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3ZtLmRlbGV0ZVByZXZUYWcoJGV2ZW50KTsKICAgICAgICB9LCBmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICBpZiAoISgiYnV0dG9uIiBpbiAkZXZlbnQpICYmIF92bS5faygkZXZlbnQua2V5Q29kZSwgInRhYiIsIDksICRldmVudC5rZXksICJUYWIiKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBfdm0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgIH1dLAogICAgICAgIGNvbXBvc2l0aW9uc3RhcnQ6IF92bS5oYW5kbGVDb21wb3NpdGlvbiwKICAgICAgICBjb21wb3NpdGlvbnVwZGF0ZTogX3ZtLmhhbmRsZUNvbXBvc2l0aW9uLAogICAgICAgIGNvbXBvc2l0aW9uZW5kOiBfdm0uaGFuZGxlQ29tcG9zaXRpb24sCiAgICAgICAgaW5wdXQ6IFtmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICBpZiAoJGV2ZW50LnRhcmdldC5jb21wb3NpbmcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIF92bS5xdWVyeSA9ICRldmVudC50YXJnZXQudmFsdWU7CiAgICAgICAgfSwgX3ZtLmRlYm91bmNlZFF1ZXJ5Q2hhbmdlXQogICAgICB9CiAgICB9KSA6IF92bS5fZSgpXSwgMSkgOiBfdm0uX2UoKSwgX2MoImVsLWlucHV0IiwgewogICAgICByZWY6ICJyZWZlcmVuY2UiLAogICAgICBjbGFzczogewogICAgICAgICJpcy1mb2N1cyI6IF92bS52aXNpYmxlCiAgICAgIH0sCiAgICAgIGF0dHJzOiB7CiAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgIHBsYWNlaG9sZGVyOiBfdm0uY3VycmVudFBsYWNlaG9sZGVyLAogICAgICAgIG5hbWU6IF92bS5uYW1lLAogICAgICAgIGlkOiBfdm0uaWQsCiAgICAgICAgYXV0b2NvbXBsZXRlOiBfdm0uYXV0b0NvbXBsZXRlIHx8IF92bS5hdXRvY29tcGxldGUsCiAgICAgICAgc2l6ZTogX3ZtLnNlbGVjdFNpemUsCiAgICAgICAgZGlzYWJsZWQ6IF92bS5zZWxlY3REaXNhYmxlZCwKICAgICAgICByZWFkb25seTogX3ZtLnJlYWRvbmx5LAogICAgICAgICJ2YWxpZGF0ZS1ldmVudCI6IGZhbHNlLAogICAgICAgIHRhYmluZGV4OiBfdm0ubXVsdGlwbGUgJiYgX3ZtLmZpbHRlcmFibGUgPyAiLTEiIDogbnVsbAogICAgICB9LAogICAgICBvbjogewogICAgICAgIGZvY3VzOiBfdm0uaGFuZGxlRm9jdXMsCiAgICAgICAgYmx1cjogX3ZtLmhhbmRsZUJsdXIKICAgICAgfSwKICAgICAgbmF0aXZlT246IHsKICAgICAgICBrZXl1cDogZnVuY3Rpb24ga2V5dXAoJGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gX3ZtLmRlYm91bmNlZE9uSW5wdXRDaGFuZ2UoJGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIGtleWRvd246IFtmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICBpZiAoISgiYnV0dG9uIiBpbiAkZXZlbnQpICYmIF92bS5faygkZXZlbnQua2V5Q29kZSwgImRvd24iLCA0MCwgJGV2ZW50LmtleSwgWyJEb3duIiwgIkFycm93RG93biJdKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICBfdm0ubmF2aWdhdGVPcHRpb25zKCJuZXh0Iik7CiAgICAgICAgfSwgZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgaWYgKCEoImJ1dHRvbiIgaW4gJGV2ZW50KSAmJiBfdm0uX2soJGV2ZW50LmtleUNvZGUsICJ1cCIsIDM4LCAkZXZlbnQua2V5LCBbIlVwIiwgIkFycm93VXAiXSkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgX3ZtLm5hdmlnYXRlT3B0aW9ucygicHJldiIpOwogICAgICAgIH0sIGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgIGlmICghKCJidXR0b24iIGluICRldmVudCkgJiYgX3ZtLl9rKCRldmVudC5rZXlDb2RlLCAiZW50ZXIiLCAxMywgJGV2ZW50LmtleSwgIkVudGVyIikpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICByZXR1cm4gX3ZtLnNlbGVjdE9wdGlvbigkZXZlbnQpOwogICAgICAgIH0sIGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgIGlmICghKCJidXR0b24iIGluICRldmVudCkgJiYgX3ZtLl9rKCRldmVudC5rZXlDb2RlLCAiZXNjIiwgMjcsICRldmVudC5rZXksIFsiRXNjIiwgIkVzY2FwZSJdKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIF92bS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgfSwgZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgaWYgKCEoImJ1dHRvbiIgaW4gJGV2ZW50KSAmJiBfdm0uX2soJGV2ZW50LmtleUNvZGUsICJ0YWIiLCA5LCAkZXZlbnQua2V5LCAiVGFiIikpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgX3ZtLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB9XSwKICAgICAgICBwYXN0ZTogZnVuY3Rpb24gcGFzdGUoJGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gX3ZtLmRlYm91bmNlZE9uSW5wdXRDaGFuZ2UoJGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uIG1vdXNlZW50ZXIoJGV2ZW50KSB7CiAgICAgICAgICBfdm0uaW5wdXRIb3ZlcmluZyA9IHRydWU7CiAgICAgICAgfSwKICAgICAgICBtb3VzZWxlYXZlOiBmdW5jdGlvbiBtb3VzZWxlYXZlKCRldmVudCkgewogICAgICAgICAgX3ZtLmlucHV0SG92ZXJpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1vZGVsOiB7CiAgICAgICAgdmFsdWU6IF92bS5zZWxlY3RlZExhYmVsLAogICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiBjYWxsYmFjaygkJHYpIHsKICAgICAgICAgIF92bS5zZWxlY3RlZExhYmVsID0gJCR2OwogICAgICAgIH0sCiAgICAgICAgZXhwcmVzc2lvbjogInNlbGVjdGVkTGFiZWwiCiAgICAgIH0KICAgIH0sIFtfdm0uJHNsb3RzLnByZWZpeCA/IF9jKCJ0ZW1wbGF0ZSIsIHsKICAgICAgc2xvdDogInByZWZpeCIKICAgIH0sIFtfdm0uX3QoInByZWZpeCIpXSwgMikgOiBfdm0uX2UoKSwgX2MoInRlbXBsYXRlIiwgewogICAgICBzbG90OiAic3VmZml4IgogICAgfSwgW19jKCJpIiwgewogICAgICBkaXJlY3RpdmVzOiBbewogICAgICAgIG5hbWU6ICJzaG93IiwKICAgICAgICByYXdOYW1lOiAidi1zaG93IiwKICAgICAgICB2YWx1ZTogIV92bS5zaG93Q2xvc2UsCiAgICAgICAgZXhwcmVzc2lvbjogIiFzaG93Q2xvc2UiCiAgICAgIH1dLAogICAgICBjbGFzczogWyJlbC1zZWxlY3RfX2NhcmV0IiwgImVsLWlucHV0X19pY29uIiwgImVsLWljb24tIiArIF92bS5pY29uQ2xhc3NdCiAgICB9KSwgX3ZtLnNob3dDbG9zZSA/IF9jKCJpIiwgewogICAgICBzdGF0aWNDbGFzczogImVsLXNlbGVjdF9fY2FyZXQgZWwtaW5wdXRfX2ljb24gZWwtaWNvbi1jaXJjbGUtY2xvc2UiLAogICAgICBvbjogewogICAgICAgIGNsaWNrOiBfdm0uaGFuZGxlQ2xlYXJDbGljawogICAgICB9CiAgICB9KSA6IF92bS5fZSgpXSldLCAyKSwgX2MoInRyYW5zaXRpb24iLCB7CiAgICAgIGF0dHJzOiB7CiAgICAgICAgbmFtZTogImVsLXpvb20taW4tdG9wIgogICAgICB9LAogICAgICBvbjogewogICAgICAgICJiZWZvcmUtZW50ZXIiOiBfdm0uaGFuZGxlTWVudUVudGVyLAogICAgICAgICJhZnRlci1sZWF2ZSI6IF92bS5kb0Rlc3Ryb3kKICAgICAgfQogICAgfSwgW19jKCJlbC1zZWxlY3QtbWVudSIsIHsKICAgICAgZGlyZWN0aXZlczogW3sKICAgICAgICBuYW1lOiAic2hvdyIsCiAgICAgICAgcmF3TmFtZTogInYtc2hvdyIsCiAgICAgICAgdmFsdWU6IF92bS52aXNpYmxlICYmIF92bS5lbXB0eVRleHQgIT09IGZhbHNlLAogICAgICAgIGV4cHJlc3Npb246ICJ2aXNpYmxlICYmIGVtcHR5VGV4dCAhPT0gZmFsc2UiCiAgICAgIH1dLAogICAgICByZWY6ICJwb3BwZXIiLAogICAgICBhdHRyczogewogICAgICAgICJhcHBlbmQtdG8tYm9keSI6IF92bS5wb3BwZXJBcHBlbmRUb0JvZHkKICAgICAgfQogICAgfSwgW19jKCJlbC1zY3JvbGxiYXIiLCB7CiAgICAgIGRpcmVjdGl2ZXM6IFt7CiAgICAgICAgbmFtZTogInNob3ciLAogICAgICAgIHJhd05hbWU6ICJ2LXNob3ciLAogICAgICAgIHZhbHVlOiBfdm0ub3B0aW9ucy5sZW5ndGggPiAwICYmICFfdm0ubG9hZGluZywKICAgICAgICBleHByZXNzaW9uOiAib3B0aW9ucy5sZW5ndGggPiAwICYmICFsb2FkaW5nIgogICAgICB9XSwKICAgICAgcmVmOiAic2Nyb2xsYmFyIiwKICAgICAgY2xhc3M6IHsKICAgICAgICAiaXMtZW1wdHkiOiAhX3ZtLmFsbG93Q3JlYXRlICYmIF92bS5xdWVyeSAmJiBfdm0uZmlsdGVyZWRPcHRpb25zQ291bnQgPT09IDAKICAgICAgfSwKICAgICAgYXR0cnM6IHsKICAgICAgICB0YWc6ICJ1bCIsCiAgICAgICAgIndyYXAtY2xhc3MiOiAiZWwtc2VsZWN0LWRyb3Bkb3duX193cmFwIiwKICAgICAgICAidmlldy1jbGFzcyI6ICJlbC1zZWxlY3QtZHJvcGRvd25fX2xpc3QiCiAgICAgIH0KICAgIH0sIFtfdm0uc2hvd05ld09wdGlvbiA/IF9jKCJlbC1vcHRpb24iLCB7CiAgICAgIGF0dHJzOiB7CiAgICAgICAgdmFsdWU6IF92bS5xdWVyeSwKICAgICAgICBjcmVhdGVkOiAiIgogICAgICB9CiAgICB9KSA6IF92bS5fZSgpLCBfdm0uX3QoImRlZmF1bHQiKV0sIDIpLCBfdm0uZW1wdHlUZXh0ICYmICghX3ZtLmFsbG93Q3JlYXRlIHx8IF92bS5sb2FkaW5nIHx8IF92bS5hbGxvd0NyZWF0ZSAmJiBfdm0ub3B0aW9ucy5sZW5ndGggPT09IDApID8gW192bS4kc2xvdHMuZW1wdHkgPyBfdm0uX3QoImVtcHR5IikgOiBfYygicCIsIHsKICAgICAgc3RhdGljQ2xhc3M6ICJlbC1zZWxlY3QtZHJvcGRvd25fX2VtcHR5IgogICAgfSwgW192bS5fdigiXG4gICAgICAgICAgIiArIF92bS5fcyhfdm0uZW1wdHlUZXh0KSArICJcbiAgICAgICAgIildKV0gOiBfdm0uX2UoKV0sIDIpXSwgMSldLCAxKTsKICB9OwoKICB2YXIgc3RhdGljUmVuZGVyRm5zID0gW107CiAgcmVuZGVyLl93aXRoU3RyaXBwZWQgPSB0cnVlOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3BhY2thZ2VzL3NlbGVjdC9zcmMvc2VsZWN0LnZ1ZT92dWUmdHlwZT10ZW1wbGF0ZSZpZD0wZTRhYWRlNiYKICAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi9taXhpbnMvZW1pdHRlciIKCiAgdmFyIGVtaXR0ZXJfID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsKCiAgdmFyIGVtaXR0ZXJfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oZW1pdHRlcl8pOyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi9taXhpbnMvZm9jdXMiCgoKICB2YXIgZm9jdXNfID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMik7CgogIHZhciBmb2N1c19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihmb2N1c18pOyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi9taXhpbnMvbG9jYWxlIgoKCiAgdmFyIGxvY2FsZV8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKICB2YXIgbG9jYWxlX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGxvY2FsZV8pOyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi9pbnB1dCIKCgogIHZhciBpbnB1dF8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgdmFyIGlucHV0X2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGlucHV0Xyk7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliL2xvYWRlcnMvdGVtcGxhdGVMb2FkZXIuanM/P3Z1ZS1sb2FkZXItb3B0aW9ucyEuL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYj8/dnVlLWxvYWRlci1vcHRpb25zIS4vcGFja2FnZXMvc2VsZWN0L3NyYy9zZWxlY3QtZHJvcGRvd24udnVlP3Z1ZSZ0eXBlPXRlbXBsYXRlJmlkPTA2ODI4NzQ4JgoKCiAgdmFyIHNlbGVjdF9kcm9wZG93bnZ1ZV90eXBlX3RlbXBsYXRlX2lkXzA2ODI4NzQ4X3JlbmRlciA9IGZ1bmN0aW9uIHNlbGVjdF9kcm9wZG93bnZ1ZV90eXBlX3RlbXBsYXRlX2lkXzA2ODI4NzQ4X3JlbmRlcigpIHsKICAgIHZhciBfdm0gPSB0aGlzOwoKICAgIHZhciBfaCA9IF92bS4kY3JlYXRlRWxlbWVudDsKCiAgICB2YXIgX2MgPSBfdm0uX3NlbGYuX2MgfHwgX2g7CgogICAgcmV0dXJuIF9jKCJkaXYiLCB7CiAgICAgIHN0YXRpY0NsYXNzOiAiZWwtc2VsZWN0LWRyb3Bkb3duIGVsLXBvcHBlciIsCiAgICAgIGNsYXNzOiBbewogICAgICAgICJpcy1tdWx0aXBsZSI6IF92bS4kcGFyZW50Lm11bHRpcGxlCiAgICAgIH0sIF92bS5wb3BwZXJDbGFzc10sCiAgICAgIHN0eWxlOiB7CiAgICAgICAgbWluV2lkdGg6IF92bS5taW5XaWR0aAogICAgICB9CiAgICB9LCBbX3ZtLl90KCJkZWZhdWx0IildLCAyKTsKICB9OwoKICB2YXIgc2VsZWN0X2Ryb3Bkb3dudnVlX3R5cGVfdGVtcGxhdGVfaWRfMDY4Mjg3NDhfc3RhdGljUmVuZGVyRm5zID0gW107CiAgc2VsZWN0X2Ryb3Bkb3dudnVlX3R5cGVfdGVtcGxhdGVfaWRfMDY4Mjg3NDhfcmVuZGVyLl93aXRoU3RyaXBwZWQgPSB0cnVlOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3BhY2thZ2VzL3NlbGVjdC9zcmMvc2VsZWN0LWRyb3Bkb3duLnZ1ZT92dWUmdHlwZT10ZW1wbGF0ZSZpZD0wNjgyODc0OCYKICAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi91dGlscy92dWUtcG9wcGVyIgoKICB2YXIgdnVlX3BvcHBlcl8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKICB2YXIgdnVlX3BvcHBlcl9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubih2dWVfcG9wcGVyXyk7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2JhYmVsLWxvYWRlci9saWIhLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWI/P3Z1ZS1sb2FkZXItb3B0aW9ucyEuL3BhY2thZ2VzL3NlbGVjdC9zcmMvc2VsZWN0LWRyb3Bkb3duLnZ1ZT92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyYKICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KCiAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgdmFyIHNlbGVjdF9kcm9wZG93bnZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXyA9IHsKICAgIG5hbWU6ICdFbFNlbGVjdERyb3Bkb3duJywKICAgIGNvbXBvbmVudE5hbWU6ICdFbFNlbGVjdERyb3Bkb3duJywKICAgIG1peGluczogW3Z1ZV9wb3BwZXJfZGVmYXVsdC5hXSwKICAgIHByb3BzOiB7CiAgICAgIHBsYWNlbWVudDogewogICAgICAgIGRlZmF1bHQ6ICdib3R0b20tc3RhcnQnCiAgICAgIH0sCiAgICAgIGJvdW5kYXJpZXNQYWRkaW5nOiB7CiAgICAgICAgZGVmYXVsdDogMAogICAgICB9LAogICAgICBwb3BwZXJPcHRpb25zOiB7CiAgICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBncHVBY2NlbGVyYXRpb246IGZhbHNlCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgdmlzaWJsZUFycm93OiB7CiAgICAgICAgZGVmYXVsdDogdHJ1ZQogICAgICB9LAogICAgICBhcHBlbmRUb0JvZHk6IHsKICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgIGRlZmF1bHQ6IHRydWUKICAgICAgfQogICAgfSwKICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbWluV2lkdGg6ICcnCiAgICAgIH07CiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgcG9wcGVyQ2xhc3M6IGZ1bmN0aW9uIHBvcHBlckNsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLiRwYXJlbnQucG9wcGVyQ2xhc3M7CiAgICAgIH0KICAgIH0sCiAgICB3YXRjaDogewogICAgICAnJHBhcmVudC5pbnB1dFdpZHRoJzogZnVuY3Rpb24gJHBhcmVudElucHV0V2lkdGgoKSB7CiAgICAgICAgdGhpcy5taW5XaWR0aCA9IHRoaXMuJHBhcmVudC4kZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggKyAncHgnOwogICAgICB9CiAgICB9LAogICAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMucmVmZXJlbmNlRWxtID0gdGhpcy4kcGFyZW50LiRyZWZzLnJlZmVyZW5jZS4kZWw7CiAgICAgIHRoaXMuJHBhcmVudC5wb3BwZXJFbG0gPSB0aGlzLnBvcHBlckVsbSA9IHRoaXMuJGVsOwogICAgICB0aGlzLiRvbigndXBkYXRlUG9wcGVyJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChfdGhpcy4kcGFyZW50LnZpc2libGUpIF90aGlzLnVwZGF0ZVBvcHBlcigpOwogICAgICB9KTsKICAgICAgdGhpcy4kb24oJ2Rlc3Ryb3lQb3BwZXInLCB0aGlzLmRlc3Ryb3lQb3BwZXIpOwogICAgfQogIH07IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvc2VsZWN0L3NyYy9zZWxlY3QtZHJvcGRvd24udnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJgoKICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovCgogIHZhciBzcmNfc2VsZWN0X2Ryb3Bkb3dudnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfID0gc2VsZWN0X2Ryb3Bkb3dudnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfOyAvLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliL3J1bnRpbWUvY29tcG9uZW50Tm9ybWFsaXplci5qcwoKICB2YXIgY29tcG9uZW50Tm9ybWFsaXplciA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvc2VsZWN0L3NyYy9zZWxlY3QtZHJvcGRvd24udnVlCgogIC8qIG5vcm1hbGl6ZSBjb21wb25lbnQgKi8KCgogIHZhciBjb21wb25lbnQgPSBPYmplY3QoY29tcG9uZW50Tm9ybWFsaXplclsiYSIKICAvKiBkZWZhdWx0ICovCiAgXSkoc3JjX3NlbGVjdF9kcm9wZG93bnZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXywgc2VsZWN0X2Ryb3Bkb3dudnVlX3R5cGVfdGVtcGxhdGVfaWRfMDY4Mjg3NDhfcmVuZGVyLCBzZWxlY3RfZHJvcGRvd252dWVfdHlwZV90ZW1wbGF0ZV9pZF8wNjgyODc0OF9zdGF0aWNSZW5kZXJGbnMsIGZhbHNlLCBudWxsLCBudWxsLCBudWxsKTsKICAvKiBob3QgcmVsb2FkICovCgogIGlmIChmYWxzZSkgewogICAgdmFyIGFwaTsKICB9CgogIGNvbXBvbmVudC5vcHRpb25zLl9fZmlsZSA9ICJwYWNrYWdlcy9zZWxlY3Qvc3JjL3NlbGVjdC1kcm9wZG93bi52dWUiOwogIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCiAgdmFyIHNlbGVjdF9kcm9wZG93biA9IGNvbXBvbmVudC5leHBvcnRzOyAvLyBFWFRFUk5BTCBNT0RVTEU6IC4vcGFja2FnZXMvc2VsZWN0L3NyYy9vcHRpb24udnVlICsgNCBtb2R1bGVzCgogIHZhciBzcmNfb3B0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNCk7IC8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwgImVsZW1lbnQtdWkvbGliL3RhZyIKCgogIHZhciB0YWdfID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCk7CgogIHZhciB0YWdfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4odGFnXyk7IC8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwgImVsZW1lbnQtdWkvbGliL3Njcm9sbGJhciIKCgogIHZhciBzY3JvbGxiYXJfID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7CgogIHZhciBzY3JvbGxiYXJfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oc2Nyb2xsYmFyXyk7IC8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwgInRocm90dGxlLWRlYm91bmNlL2RlYm91bmNlIgoKCiAgdmFyIGRlYm91bmNlXyA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOwoKICB2YXIgZGVib3VuY2VfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oZGVib3VuY2VfKTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvdXRpbHMvY2xpY2tvdXRzaWRlIgoKCiAgdmFyIGNsaWNrb3V0c2lkZV8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgdmFyIGNsaWNrb3V0c2lkZV9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihjbGlja291dHNpZGVfKTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvdXRpbHMvcmVzaXplLWV2ZW50IgoKCiAgdmFyIHJlc2l6ZV9ldmVudF8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvbG9jYWxlIgoKCiAgdmFyIGxpYl9sb2NhbGVfID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7IC8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwgImVsZW1lbnQtdWkvbGliL3V0aWxzL3Njcm9sbC1pbnRvLXZpZXciCgoKICB2YXIgc2Nyb2xsX2ludG9fdmlld18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMxKTsKCiAgdmFyIHNjcm9sbF9pbnRvX3ZpZXdfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oc2Nyb2xsX2ludG9fdmlld18pOyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi91dGlscy91dGlsIgoKCiAgdmFyIHV0aWxfID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9zZWxlY3Qvc3JjL25hdmlnYXRpb24tbWl4aW4uanMKCiAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgdmFyIG5hdmlnYXRpb25fbWl4aW4gPSB7CiAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgICByZXR1cm4gewogICAgICAgIGhvdmVyT3B0aW9uOiAtMQogICAgICB9OwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgIG9wdGlvbnNBbGxEaXNhYmxlZDogZnVuY3Rpb24gb3B0aW9uc0FsbERpc2FibGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZmlsdGVyKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgIHJldHVybiBvcHRpb24udmlzaWJsZTsKICAgICAgICB9KS5ldmVyeShmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uLmRpc2FibGVkOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgaG92ZXJJbmRleDogZnVuY3Rpb24gaG92ZXJJbmRleCh2YWwpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicgJiYgdmFsID4gLTEpIHsKICAgICAgICAgIHRoaXMuaG92ZXJPcHRpb24gPSB0aGlzLm9wdGlvbnNbdmFsXSB8fCB7fTsKICAgICAgICB9CgogICAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgIG9wdGlvbi5ob3ZlciA9IF90aGlzLmhvdmVyT3B0aW9uID09PSBvcHRpb247CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgIG5hdmlnYXRlT3B0aW9uczogZnVuY3Rpb24gbmF2aWdhdGVPcHRpb25zKGRpcmVjdGlvbikgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICBpZiAoIXRoaXMudmlzaWJsZSkgewogICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGVuZ3RoID09PSAwIHx8IHRoaXMuZmlsdGVyZWRPcHRpb25zQ291bnQgPT09IDApIHJldHVybjsKCiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnNBbGxEaXNhYmxlZCkgewogICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ25leHQnKSB7CiAgICAgICAgICAgIHRoaXMuaG92ZXJJbmRleCsrOwoKICAgICAgICAgICAgaWYgKHRoaXMuaG92ZXJJbmRleCA9PT0gdGhpcy5vcHRpb25zLmxlbmd0aCkgewogICAgICAgICAgICAgIHRoaXMuaG92ZXJJbmRleCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAncHJldicpIHsKICAgICAgICAgICAgdGhpcy5ob3ZlckluZGV4LS07CgogICAgICAgICAgICBpZiAodGhpcy5ob3ZlckluZGV4IDwgMCkgewogICAgICAgICAgICAgIHRoaXMuaG92ZXJJbmRleCA9IHRoaXMub3B0aW9ucy5sZW5ndGggLSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG9wdGlvbiA9IHRoaXMub3B0aW9uc1t0aGlzLmhvdmVySW5kZXhdOwoKICAgICAgICAgIGlmIChvcHRpb24uZGlzYWJsZWQgPT09IHRydWUgfHwgb3B0aW9uLmdyb3VwRGlzYWJsZWQgPT09IHRydWUgfHwgIW9wdGlvbi52aXNpYmxlKSB7CiAgICAgICAgICAgIHRoaXMubmF2aWdhdGVPcHRpb25zKGRpcmVjdGlvbik7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMyLnNjcm9sbFRvT3B0aW9uKF90aGlzMi5ob3Zlck9wdGlvbik7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi91dGlscy9zaGFyZWQiCgogIHZhciBzaGFyZWRfID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2JhYmVsLWxvYWRlci9saWIhLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWI/P3Z1ZS1sb2FkZXItb3B0aW9ucyEuL3BhY2thZ2VzL3NlbGVjdC9zcmMvc2VsZWN0LnZ1ZT92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyYKICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KICAvLwogIC8vCiAgLy8KCiAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgdmFyIHNlbGVjdHZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXyA9IHsKICAgIG1peGluczogW2VtaXR0ZXJfZGVmYXVsdC5hLCBsb2NhbGVfZGVmYXVsdC5hLCBmb2N1c19kZWZhdWx0KCkoJ3JlZmVyZW5jZScpLCBuYXZpZ2F0aW9uX21peGluXSwKICAgIG5hbWU6ICdFbFNlbGVjdCcsCiAgICBjb21wb25lbnROYW1lOiAnRWxTZWxlY3QnLAogICAgaW5qZWN0OiB7CiAgICAgIGVsRm9ybTogewogICAgICAgIGRlZmF1bHQ6ICcnCiAgICAgIH0sCiAgICAgIGVsRm9ybUl0ZW06IHsKICAgICAgICBkZWZhdWx0OiAnJwogICAgICB9CiAgICB9LAogICAgcHJvdmlkZTogZnVuY3Rpb24gcHJvdmlkZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAnc2VsZWN0JzogdGhpcwogICAgICB9OwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgIF9lbEZvcm1JdGVtU2l6ZTogZnVuY3Rpb24gX2VsRm9ybUl0ZW1TaXplKCkgewogICAgICAgIHJldHVybiAodGhpcy5lbEZvcm1JdGVtIHx8IHt9KS5lbEZvcm1JdGVtU2l6ZTsKICAgICAgfSwKICAgICAgcmVhZG9ubHk6IGZ1bmN0aW9uIHJlYWRvbmx5KCkgewogICAgICAgIHJldHVybiAhdGhpcy5maWx0ZXJhYmxlIHx8IHRoaXMubXVsdGlwbGUgfHwgIU9iamVjdCh1dGlsX1siaXNJRSJdKSgpICYmICFPYmplY3QodXRpbF9bImlzRWRnZSJdKSgpICYmICF0aGlzLnZpc2libGU7CiAgICAgIH0sCiAgICAgIHNob3dDbG9zZTogZnVuY3Rpb24gc2hvd0Nsb3NlKCkgewogICAgICAgIHZhciBoYXNWYWx1ZSA9IHRoaXMubXVsdGlwbGUgPyBBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpICYmIHRoaXMudmFsdWUubGVuZ3RoID4gMCA6IHRoaXMudmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnZhbHVlICE9PSBudWxsICYmIHRoaXMudmFsdWUgIT09ICcnOwogICAgICAgIHZhciBjcml0ZXJpYSA9IHRoaXMuY2xlYXJhYmxlICYmICF0aGlzLnNlbGVjdERpc2FibGVkICYmIHRoaXMuaW5wdXRIb3ZlcmluZyAmJiBoYXNWYWx1ZTsKICAgICAgICByZXR1cm4gY3JpdGVyaWE7CiAgICAgIH0sCiAgICAgIGljb25DbGFzczogZnVuY3Rpb24gaWNvbkNsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLnJlbW90ZSAmJiB0aGlzLmZpbHRlcmFibGUgPyAnJyA6IHRoaXMudmlzaWJsZSA/ICdhcnJvdy11cCBpcy1yZXZlcnNlJyA6ICdhcnJvdy11cCc7CiAgICAgIH0sCiAgICAgIGRlYm91bmNlOiBmdW5jdGlvbiBkZWJvdW5jZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZW1vdGUgPyAzMDAgOiAwOwogICAgICB9LAogICAgICBlbXB0eVRleHQ6IGZ1bmN0aW9uIGVtcHR5VGV4dCgpIHsKICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkaW5nVGV4dCB8fCB0aGlzLnQoJ2VsLnNlbGVjdC5sb2FkaW5nJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0aGlzLnJlbW90ZSAmJiB0aGlzLnF1ZXJ5ID09PSAnJyAmJiB0aGlzLm9wdGlvbnMubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgaWYgKHRoaXMuZmlsdGVyYWJsZSAmJiB0aGlzLnF1ZXJ5ICYmIHRoaXMub3B0aW9ucy5sZW5ndGggPiAwICYmIHRoaXMuZmlsdGVyZWRPcHRpb25zQ291bnQgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9NYXRjaFRleHQgfHwgdGhpcy50KCdlbC5zZWxlY3Qubm9NYXRjaCcpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vRGF0YVRleHQgfHwgdGhpcy50KCdlbC5zZWxlY3Qubm9EYXRhJyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSwKICAgICAgc2hvd05ld09wdGlvbjogZnVuY3Rpb24gc2hvd05ld09wdGlvbigpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgaGFzRXhpc3RpbmdPcHRpb24gPSB0aGlzLm9wdGlvbnMuZmlsdGVyKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgIHJldHVybiAhb3B0aW9uLmNyZWF0ZWQ7CiAgICAgICAgfSkuc29tZShmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uLmN1cnJlbnRMYWJlbCA9PT0gX3RoaXMucXVlcnk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyYWJsZSAmJiB0aGlzLmFsbG93Q3JlYXRlICYmIHRoaXMucXVlcnkgIT09ICcnICYmICFoYXNFeGlzdGluZ09wdGlvbjsKICAgICAgfSwKICAgICAgc2VsZWN0U2l6ZTogZnVuY3Rpb24gc2VsZWN0U2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zaXplIHx8IHRoaXMuX2VsRm9ybUl0ZW1TaXplIHx8ICh0aGlzLiRFTEVNRU5UIHx8IHt9KS5zaXplOwogICAgICB9LAogICAgICBzZWxlY3REaXNhYmxlZDogZnVuY3Rpb24gc2VsZWN0RGlzYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgfHwgKHRoaXMuZWxGb3JtIHx8IHt9KS5kaXNhYmxlZDsKICAgICAgfSwKICAgICAgY29sbGFwc2VUYWdTaXplOiBmdW5jdGlvbiBjb2xsYXBzZVRhZ1NpemUoKSB7CiAgICAgICAgcmV0dXJuIFsnc21hbGwnLCAnbWluaSddLmluZGV4T2YodGhpcy5zZWxlY3RTaXplKSA+IC0xID8gJ21pbmknIDogJ3NtYWxsJzsKICAgICAgfQogICAgfSwKICAgIGNvbXBvbmVudHM6IHsKICAgICAgRWxJbnB1dDogaW5wdXRfZGVmYXVsdC5hLAogICAgICBFbFNlbGVjdE1lbnU6IHNlbGVjdF9kcm9wZG93biwKICAgICAgRWxPcHRpb246IHNyY19vcHRpb25bImEiCiAgICAgIC8qIGRlZmF1bHQgKi8KICAgICAgXSwKICAgICAgRWxUYWc6IHRhZ19kZWZhdWx0LmEsCiAgICAgIEVsU2Nyb2xsYmFyOiBzY3JvbGxiYXJfZGVmYXVsdC5hCiAgICB9LAogICAgZGlyZWN0aXZlczogewogICAgICBDbGlja291dHNpZGU6IGNsaWNrb3V0c2lkZV9kZWZhdWx0LmEKICAgIH0sCiAgICBwcm9wczogewogICAgICBuYW1lOiBTdHJpbmcsCiAgICAgIGlkOiBTdHJpbmcsCiAgICAgIHZhbHVlOiB7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgfSwKICAgICAgYXV0b2NvbXBsZXRlOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIGRlZmF1bHQ6ICdvZmYnCiAgICAgIH0sCgogICAgICAvKiogQERlcHJlY2F0ZWQgaW4gbmV4dCBtYWpvciB2ZXJzaW9uICovCiAgICAgIGF1dG9Db21wbGV0ZTogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uIHZhbGlkYXRvcih2YWwpIHsKICAgICAgICAgIGZhbHNlICYmIGZhbHNlOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9LAogICAgICBhdXRvbWF0aWNEcm9wZG93bjogQm9vbGVhbiwKICAgICAgc2l6ZTogU3RyaW5nLAogICAgICBkaXNhYmxlZDogQm9vbGVhbiwKICAgICAgY2xlYXJhYmxlOiBCb29sZWFuLAogICAgICBmaWx0ZXJhYmxlOiBCb29sZWFuLAogICAgICBhbGxvd0NyZWF0ZTogQm9vbGVhbiwKICAgICAgbG9hZGluZzogQm9vbGVhbiwKICAgICAgcG9wcGVyQ2xhc3M6IFN0cmluZywKICAgICAgcmVtb3RlOiBCb29sZWFuLAogICAgICBsb2FkaW5nVGV4dDogU3RyaW5nLAogICAgICBub01hdGNoVGV4dDogU3RyaW5nLAogICAgICBub0RhdGFUZXh0OiBTdHJpbmcsCiAgICAgIHJlbW90ZU1ldGhvZDogRnVuY3Rpb24sCiAgICAgIGZpbHRlck1ldGhvZDogRnVuY3Rpb24sCiAgICAgIG11bHRpcGxlOiBCb29sZWFuLAogICAgICBtdWx0aXBsZUxpbWl0OiB7CiAgICAgICAgdHlwZTogTnVtYmVyLAogICAgICAgIGRlZmF1bHQ6IDAKICAgICAgfSwKICAgICAgcGxhY2Vob2xkZXI6IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0KGxpYl9sb2NhbGVfWyJ0Il0pKCdlbC5zZWxlY3QucGxhY2Vob2xkZXInKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlZmF1bHRGaXJzdE9wdGlvbjogQm9vbGVhbiwKICAgICAgcmVzZXJ2ZUtleXdvcmQ6IEJvb2xlYW4sCiAgICAgIHZhbHVlS2V5OiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIGRlZmF1bHQ6ICd2YWx1ZScKICAgICAgfSwKICAgICAgY29sbGFwc2VUYWdzOiBCb29sZWFuLAogICAgICBwb3BwZXJBcHBlbmRUb0JvZHk6IHsKICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgIGRlZmF1bHQ6IHRydWUKICAgICAgfQogICAgfSwKICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3B0aW9uczogW10sCiAgICAgICAgY2FjaGVkT3B0aW9uczogW10sCiAgICAgICAgY3JlYXRlZExhYmVsOiBudWxsLAogICAgICAgIGNyZWF0ZWRTZWxlY3RlZDogZmFsc2UsCiAgICAgICAgc2VsZWN0ZWQ6IHRoaXMubXVsdGlwbGUgPyBbXSA6IHt9LAogICAgICAgIGlucHV0TGVuZ3RoOiAyMCwKICAgICAgICBpbnB1dFdpZHRoOiAwLAogICAgICAgIGluaXRpYWxJbnB1dEhlaWdodDogMCwKICAgICAgICBjYWNoZWRQbGFjZUhvbGRlcjogJycsCiAgICAgICAgb3B0aW9uc0NvdW50OiAwLAogICAgICAgIGZpbHRlcmVkT3B0aW9uc0NvdW50OiAwLAogICAgICAgIHZpc2libGU6IGZhbHNlLAogICAgICAgIHNvZnRGb2N1czogZmFsc2UsCiAgICAgICAgc2VsZWN0ZWRMYWJlbDogJycsCiAgICAgICAgaG92ZXJJbmRleDogLTEsCiAgICAgICAgcXVlcnk6ICcnLAogICAgICAgIHByZXZpb3VzUXVlcnk6IG51bGwsCiAgICAgICAgaW5wdXRIb3ZlcmluZzogZmFsc2UsCiAgICAgICAgY3VycmVudFBsYWNlaG9sZGVyOiAnJywKICAgICAgICBtZW51VmlzaWJsZU9uRm9jdXM6IGZhbHNlLAogICAgICAgIGlzT25Db21wb3NpdGlvbjogZmFsc2UsCiAgICAgICAgaXNTaWxlbnRCbHVyOiBmYWxzZQogICAgICB9OwogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgIHNlbGVjdERpc2FibGVkOiBmdW5jdGlvbiBzZWxlY3REaXNhYmxlZCgpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLnJlc2V0SW5wdXRIZWlnaHQoKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcGxhY2Vob2xkZXI6IGZ1bmN0aW9uIHBsYWNlaG9sZGVyKHZhbCkgewogICAgICAgIHRoaXMuY2FjaGVkUGxhY2VIb2xkZXIgPSB0aGlzLmN1cnJlbnRQbGFjZWhvbGRlciA9IHZhbDsKICAgICAgfSwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHZhbCwgb2xkVmFsKSB7CiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHsKICAgICAgICAgIHRoaXMucmVzZXRJbnB1dEhlaWdodCgpOwoKICAgICAgICAgIGlmICh2YWwgJiYgdmFsLmxlbmd0aCA+IDAgfHwgdGhpcy4kcmVmcy5pbnB1dCAmJiB0aGlzLnF1ZXJ5ICE9PSAnJykgewogICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGFjZWhvbGRlciA9ICcnOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxhY2Vob2xkZXIgPSB0aGlzLmNhY2hlZFBsYWNlSG9sZGVyOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmZpbHRlcmFibGUgJiYgIXRoaXMucmVzZXJ2ZUtleXdvcmQpIHsKICAgICAgICAgICAgdGhpcy5xdWVyeSA9ICcnOwogICAgICAgICAgICB0aGlzLmhhbmRsZVF1ZXJ5Q2hhbmdlKHRoaXMucXVlcnkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZCgpOwoKICAgICAgICBpZiAodGhpcy5maWx0ZXJhYmxlICYmICF0aGlzLm11bHRpcGxlKSB7CiAgICAgICAgICB0aGlzLmlucHV0TGVuZ3RoID0gMjA7CiAgICAgICAgfQoKICAgICAgICBpZiAoIU9iamVjdCh1dGlsX1sidmFsdWVFcXVhbHMiXSkodmFsLCBvbGRWYWwpKSB7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoKCdFbEZvcm1JdGVtJywgJ2VsLmZvcm0uY2hhbmdlJywgdmFsKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHZpc2libGU6IGZ1bmN0aW9uIHZpc2libGUodmFsKSB7CiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAgIGlmICghdmFsKSB7CiAgICAgICAgICB0aGlzLmJyb2FkY2FzdCgnRWxTZWxlY3REcm9wZG93bicsICdkZXN0cm95UG9wcGVyJyk7CgogICAgICAgICAgaWYgKHRoaXMuJHJlZnMuaW5wdXQpIHsKICAgICAgICAgICAgdGhpcy4kcmVmcy5pbnB1dC5ibHVyKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5xdWVyeSA9ICcnOwogICAgICAgICAgdGhpcy5wcmV2aW91c1F1ZXJ5ID0gbnVsbDsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMYWJlbCA9ICcnOwogICAgICAgICAgdGhpcy5pbnB1dExlbmd0aCA9IDIwOwogICAgICAgICAgdGhpcy5tZW51VmlzaWJsZU9uRm9jdXMgPSBmYWxzZTsKICAgICAgICAgIHRoaXMucmVzZXRIb3ZlckluZGV4KCk7CiAgICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpczMuJHJlZnMuaW5wdXQgJiYgX3RoaXMzLiRyZWZzLmlucHV0LnZhbHVlID09PSAnJyAmJiBfdGhpczMuc2VsZWN0ZWQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgX3RoaXMzLmN1cnJlbnRQbGFjZWhvbGRlciA9IF90aGlzMy5jYWNoZWRQbGFjZUhvbGRlcjsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCF0aGlzLm11bHRpcGxlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuZmlsdGVyYWJsZSAmJiB0aGlzLmFsbG93Q3JlYXRlICYmIHRoaXMuY3JlYXRlZFNlbGVjdGVkICYmIHRoaXMuY3JlYXRlZExhYmVsKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGFiZWwgPSB0aGlzLmNyZWF0ZWRMYWJlbDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZExhYmVsID0gdGhpcy5zZWxlY3RlZC5jdXJyZW50TGFiZWw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodGhpcy5maWx0ZXJhYmxlKSB0aGlzLnF1ZXJ5ID0gdGhpcy5zZWxlY3RlZExhYmVsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5maWx0ZXJhYmxlKSB7CiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxhY2Vob2xkZXIgPSB0aGlzLmNhY2hlZFBsYWNlSG9sZGVyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYnJvYWRjYXN0KCdFbFNlbGVjdERyb3Bkb3duJywgJ3VwZGF0ZVBvcHBlcicpOwoKICAgICAgICAgIGlmICh0aGlzLmZpbHRlcmFibGUpIHsKICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHRoaXMucmVtb3RlID8gJycgOiB0aGlzLnNlbGVjdGVkTGFiZWw7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUXVlcnlDaGFuZ2UodGhpcy5xdWVyeSk7CgogICAgICAgICAgICBpZiAodGhpcy5tdWx0aXBsZSkgewogICAgICAgICAgICAgIHRoaXMuJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMucmVtb3RlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJyb2FkY2FzdCgnRWxPcHRpb24nLCAncXVlcnlDaGFuZ2UnLCAnJyk7CiAgICAgICAgICAgICAgICB0aGlzLmJyb2FkY2FzdCgnRWxPcHRpb25Hcm91cCcsICdxdWVyeUNoYW5nZScpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRMYWJlbCkgewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxhY2Vob2xkZXIgPSB0aGlzLnNlbGVjdGVkTGFiZWw7CiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTGFiZWwgPSAnJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3Zpc2libGUtY2hhbmdlJywgdmFsKTsKICAgICAgfSwKICAgICAgb3B0aW9uczogZnVuY3Rpb24gb3B0aW9ucygpIHsKICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMuJGlzU2VydmVyKSByZXR1cm47CiAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM0LmJyb2FkY2FzdCgnRWxTZWxlY3REcm9wZG93bicsICd1cGRhdGVQb3BwZXInKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHsKICAgICAgICAgIHRoaXMucmVzZXRJbnB1dEhlaWdodCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGlucHV0cyA9IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0Jyk7CgogICAgICAgIGlmIChbXS5pbmRleE9mLmNhbGwoaW5wdXRzLCBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSA9PT0gLTEpIHsKICAgICAgICAgIHRoaXMuc2V0U2VsZWN0ZWQoKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmRlZmF1bHRGaXJzdE9wdGlvbiAmJiAodGhpcy5maWx0ZXJhYmxlIHx8IHRoaXMucmVtb3RlKSAmJiB0aGlzLmZpbHRlcmVkT3B0aW9uc0NvdW50KSB7CiAgICAgICAgICB0aGlzLmNoZWNrRGVmYXVsdEZpcnN0T3B0aW9uKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICBoYW5kbGVDb21wb3NpdGlvbjogZnVuY3Rpb24gaGFuZGxlQ29tcG9zaXRpb24oZXZlbnQpIHsKICAgICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgICAgdmFyIHRleHQgPSBldmVudC50YXJnZXQudmFsdWU7CgogICAgICAgIGlmIChldmVudC50eXBlID09PSAnY29tcG9zaXRpb25lbmQnKSB7CiAgICAgICAgICB0aGlzLmlzT25Db21wb3NpdGlvbiA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKF8pIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzNS5oYW5kbGVRdWVyeUNoYW5nZSh0ZXh0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgbGFzdENoYXJhY3RlciA9IHRleHRbdGV4dC5sZW5ndGggLSAxXSB8fCAnJzsKICAgICAgICAgIHRoaXMuaXNPbkNvbXBvc2l0aW9uID0gIU9iamVjdChzaGFyZWRfWyJpc0tvcmVhbiJdKShsYXN0Q2hhcmFjdGVyKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhhbmRsZVF1ZXJ5Q2hhbmdlOiBmdW5jdGlvbiBoYW5kbGVRdWVyeUNoYW5nZSh2YWwpIHsKICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMucHJldmlvdXNRdWVyeSA9PT0gdmFsIHx8IHRoaXMuaXNPbkNvbXBvc2l0aW9uKSByZXR1cm47CgogICAgICAgIGlmICh0aGlzLnByZXZpb3VzUXVlcnkgPT09IG51bGwgJiYgKHR5cGVvZiB0aGlzLmZpbHRlck1ldGhvZCA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgdGhpcy5yZW1vdGVNZXRob2QgPT09ICdmdW5jdGlvbicpKSB7CiAgICAgICAgICB0aGlzLnByZXZpb3VzUXVlcnkgPSB2YWw7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnByZXZpb3VzUXVlcnkgPSB2YWw7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKF90aGlzNi52aXNpYmxlKSBfdGhpczYuYnJvYWRjYXN0KCdFbFNlbGVjdERyb3Bkb3duJywgJ3VwZGF0ZVBvcHBlcicpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaG92ZXJJbmRleCA9IC0xOwoKICAgICAgICBpZiAodGhpcy5tdWx0aXBsZSAmJiB0aGlzLmZpbHRlcmFibGUpIHsKICAgICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IF90aGlzNi4kcmVmcy5pbnB1dC52YWx1ZS5sZW5ndGggKiAxNSArIDIwOwogICAgICAgICAgICBfdGhpczYuaW5wdXRMZW5ndGggPSBfdGhpczYuY29sbGFwc2VUYWdzID8gTWF0aC5taW4oNTAsIGxlbmd0aCkgOiBsZW5ndGg7CgogICAgICAgICAgICBfdGhpczYubWFuYWdlUGxhY2Vob2xkZXIoKTsKCiAgICAgICAgICAgIF90aGlzNi5yZXNldElucHV0SGVpZ2h0KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnJlbW90ZSAmJiB0eXBlb2YgdGhpcy5yZW1vdGVNZXRob2QgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHRoaXMuaG92ZXJJbmRleCA9IC0xOwogICAgICAgICAgdGhpcy5yZW1vdGVNZXRob2QodmFsKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLmZpbHRlck1ldGhvZCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhpcy5maWx0ZXJNZXRob2QodmFsKTsKICAgICAgICAgIHRoaXMuYnJvYWRjYXN0KCdFbE9wdGlvbkdyb3VwJywgJ3F1ZXJ5Q2hhbmdlJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zQ291bnQgPSB0aGlzLm9wdGlvbnNDb3VudDsKICAgICAgICAgIHRoaXMuYnJvYWRjYXN0KCdFbE9wdGlvbicsICdxdWVyeUNoYW5nZScsIHZhbCk7CiAgICAgICAgICB0aGlzLmJyb2FkY2FzdCgnRWxPcHRpb25Hcm91cCcsICdxdWVyeUNoYW5nZScpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdEZpcnN0T3B0aW9uICYmICh0aGlzLmZpbHRlcmFibGUgfHwgdGhpcy5yZW1vdGUpICYmIHRoaXMuZmlsdGVyZWRPcHRpb25zQ291bnQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tEZWZhdWx0Rmlyc3RPcHRpb24oKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNjcm9sbFRvT3B0aW9uOiBmdW5jdGlvbiBzY3JvbGxUb09wdGlvbihvcHRpb24pIHsKICAgICAgICB2YXIgdGFyZ2V0ID0gQXJyYXkuaXNBcnJheShvcHRpb24pICYmIG9wdGlvblswXSA/IG9wdGlvblswXS4kZWwgOiBvcHRpb24uJGVsOwoKICAgICAgICBpZiAodGhpcy4kcmVmcy5wb3BwZXIgJiYgdGFyZ2V0KSB7CiAgICAgICAgICB2YXIgbWVudSA9IHRoaXMuJHJlZnMucG9wcGVyLiRlbC5xdWVyeVNlbGVjdG9yKCcuZWwtc2VsZWN0LWRyb3Bkb3duX193cmFwJyk7CiAgICAgICAgICBzY3JvbGxfaW50b192aWV3X2RlZmF1bHQoKShtZW51LCB0YXJnZXQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy4kcmVmcy5zY3JvbGxiYXIgJiYgdGhpcy4kcmVmcy5zY3JvbGxiYXIuaGFuZGxlU2Nyb2xsKCk7CiAgICAgIH0sCiAgICAgIGhhbmRsZU1lbnVFbnRlcjogZnVuY3Rpb24gaGFuZGxlTWVudUVudGVyKCkgewogICAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM3LnNjcm9sbFRvT3B0aW9uKF90aGlzNy5zZWxlY3RlZCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGVtaXRDaGFuZ2U6IGZ1bmN0aW9uIGVtaXRDaGFuZ2UodmFsKSB7CiAgICAgICAgaWYgKCFPYmplY3QodXRpbF9bInZhbHVlRXF1YWxzIl0pKHRoaXMudmFsdWUsIHZhbCkpIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ2NoYW5nZScsIHZhbCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBnZXRPcHRpb246IGZ1bmN0aW9uIGdldE9wdGlvbih2YWx1ZSkgewogICAgICAgIHZhciBvcHRpb24gPSB2b2lkIDA7CiAgICAgICAgdmFyIGlzT2JqZWN0ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKS50b0xvd2VyQ2FzZSgpID09PSAnW29iamVjdCBvYmplY3RdJzsKICAgICAgICB2YXIgaXNOdWxsID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKS50b0xvd2VyQ2FzZSgpID09PSAnW29iamVjdCBudWxsXSc7CiAgICAgICAgdmFyIGlzVW5kZWZpbmVkID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKS50b0xvd2VyQ2FzZSgpID09PSAnW29iamVjdCB1bmRlZmluZWRdJzsKCiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuY2FjaGVkT3B0aW9ucy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgdmFyIGNhY2hlZE9wdGlvbiA9IHRoaXMuY2FjaGVkT3B0aW9uc1tpXTsKICAgICAgICAgIHZhciBpc0VxdWFsID0gaXNPYmplY3QgPyBPYmplY3QodXRpbF9bImdldFZhbHVlQnlQYXRoIl0pKGNhY2hlZE9wdGlvbi52YWx1ZSwgdGhpcy52YWx1ZUtleSkgPT09IE9iamVjdCh1dGlsX1siZ2V0VmFsdWVCeVBhdGgiXSkodmFsdWUsIHRoaXMudmFsdWVLZXkpIDogY2FjaGVkT3B0aW9uLnZhbHVlID09PSB2YWx1ZTsKCiAgICAgICAgICBpZiAoaXNFcXVhbCkgewogICAgICAgICAgICBvcHRpb24gPSBjYWNoZWRPcHRpb247CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG9wdGlvbikgcmV0dXJuIG9wdGlvbjsKICAgICAgICB2YXIgbGFiZWwgPSAhaXNPYmplY3QgJiYgIWlzTnVsbCAmJiAhaXNVbmRlZmluZWQgPyB2YWx1ZSA6ICcnOwogICAgICAgIHZhciBuZXdPcHRpb24gPSB7CiAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICBjdXJyZW50TGFiZWw6IGxhYmVsCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHsKICAgICAgICAgIG5ld09wdGlvbi5oaXRTdGF0ZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ld09wdGlvbjsKICAgICAgfSwKICAgICAgc2V0U2VsZWN0ZWQ6IGZ1bmN0aW9uIHNldFNlbGVjdGVkKCkgewogICAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHsKICAgICAgICAgIHZhciBvcHRpb24gPSB0aGlzLmdldE9wdGlvbih0aGlzLnZhbHVlKTsKCiAgICAgICAgICBpZiAob3B0aW9uLmNyZWF0ZWQpIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVkTGFiZWwgPSBvcHRpb24uY3VycmVudExhYmVsOwogICAgICAgICAgICB0aGlzLmNyZWF0ZWRTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmNyZWF0ZWRTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRMYWJlbCA9IG9wdGlvbi5jdXJyZW50TGFiZWw7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gb3B0aW9uOwogICAgICAgICAgaWYgKHRoaXMuZmlsdGVyYWJsZSkgdGhpcy5xdWVyeSA9IHRoaXMuc2VsZWN0ZWRMYWJlbDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkpIHsKICAgICAgICAgIHRoaXMudmFsdWUuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goX3RoaXM4LmdldE9wdGlvbih2YWx1ZSkpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNlbGVjdGVkID0gcmVzdWx0OwogICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzOC5yZXNldElucHV0SGVpZ2h0KCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGhhbmRsZUZvY3VzOiBmdW5jdGlvbiBoYW5kbGVGb2N1cyhldmVudCkgewogICAgICAgIGlmICghdGhpcy5zb2Z0Rm9jdXMpIHsKICAgICAgICAgIGlmICh0aGlzLmF1dG9tYXRpY0Ryb3Bkb3duIHx8IHRoaXMuZmlsdGVyYWJsZSkgewogICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHRoaXMuZmlsdGVyYWJsZSkgewogICAgICAgICAgICAgIHRoaXMubWVudVZpc2libGVPbkZvY3VzID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuJGVtaXQoJ2ZvY3VzJywgZXZlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNvZnRGb2N1cyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmx1cjogZnVuY3Rpb24gYmx1cigpIHsKICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLiRyZWZzLnJlZmVyZW5jZS5ibHVyKCk7CiAgICAgIH0sCiAgICAgIGhhbmRsZUJsdXI6IGZ1bmN0aW9uIGhhbmRsZUJsdXIoZXZlbnQpIHsKICAgICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXM5LmlzU2lsZW50Qmx1cikgewogICAgICAgICAgICBfdGhpczkuaXNTaWxlbnRCbHVyID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczkuJGVtaXQoJ2JsdXInLCBldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgNTApOwogICAgICAgIHRoaXMuc29mdEZvY3VzID0gZmFsc2U7CiAgICAgIH0sCiAgICAgIGhhbmRsZUNsZWFyQ2xpY2s6IGZ1bmN0aW9uIGhhbmRsZUNsZWFyQ2xpY2soZXZlbnQpIHsKICAgICAgICB0aGlzLmRlbGV0ZVNlbGVjdGVkKGV2ZW50KTsKICAgICAgfSwKICAgICAgZG9EZXN0cm95OiBmdW5jdGlvbiBkb0Rlc3Ryb3koKSB7CiAgICAgICAgdGhpcy4kcmVmcy5wb3BwZXIgJiYgdGhpcy4kcmVmcy5wb3BwZXIuZG9EZXN0cm95KCk7CiAgICAgIH0sCiAgICAgIGhhbmRsZUNsb3NlOiBmdW5jdGlvbiBoYW5kbGVDbG9zZSgpIHsKICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTsKICAgICAgfSwKICAgICAgdG9nZ2xlTGFzdE9wdGlvbkhpdFN0YXRlOiBmdW5jdGlvbiB0b2dnbGVMYXN0T3B0aW9uSGl0U3RhdGUoaGl0KSB7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMuc2VsZWN0ZWQpKSByZXR1cm47CiAgICAgICAgdmFyIG9wdGlvbiA9IHRoaXMuc2VsZWN0ZWRbdGhpcy5zZWxlY3RlZC5sZW5ndGggLSAxXTsKICAgICAgICBpZiAoIW9wdGlvbikgcmV0dXJuOwoKICAgICAgICBpZiAoaGl0ID09PSB0cnVlIHx8IGhpdCA9PT0gZmFsc2UpIHsKICAgICAgICAgIG9wdGlvbi5oaXRTdGF0ZSA9IGhpdDsKICAgICAgICAgIHJldHVybiBoaXQ7CiAgICAgICAgfQoKICAgICAgICBvcHRpb24uaGl0U3RhdGUgPSAhb3B0aW9uLmhpdFN0YXRlOwogICAgICAgIHJldHVybiBvcHRpb24uaGl0U3RhdGU7CiAgICAgIH0sCiAgICAgIGRlbGV0ZVByZXZUYWc6IGZ1bmN0aW9uIGRlbGV0ZVByZXZUYWcoZSkgewogICAgICAgIGlmIChlLnRhcmdldC52YWx1ZS5sZW5ndGggPD0gMCAmJiAhdGhpcy50b2dnbGVMYXN0T3B0aW9uSGl0U3RhdGUoKSkgewogICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52YWx1ZS5zbGljZSgpOwogICAgICAgICAgdmFsdWUucG9wKCk7CiAgICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKTsKICAgICAgICAgIHRoaXMuZW1pdENoYW5nZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBtYW5hZ2VQbGFjZWhvbGRlcjogZnVuY3Rpb24gbWFuYWdlUGxhY2Vob2xkZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuY3VycmVudFBsYWNlaG9sZGVyICE9PSAnJykgewogICAgICAgICAgdGhpcy5jdXJyZW50UGxhY2Vob2xkZXIgPSB0aGlzLiRyZWZzLmlucHV0LnZhbHVlID8gJycgOiB0aGlzLmNhY2hlZFBsYWNlSG9sZGVyOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVzZXRJbnB1dFN0YXRlOiBmdW5jdGlvbiByZXNldElucHV0U3RhdGUoZSkgewogICAgICAgIGlmIChlLmtleUNvZGUgIT09IDgpIHRoaXMudG9nZ2xlTGFzdE9wdGlvbkhpdFN0YXRlKGZhbHNlKTsKICAgICAgICB0aGlzLmlucHV0TGVuZ3RoID0gdGhpcy4kcmVmcy5pbnB1dC52YWx1ZS5sZW5ndGggKiAxNSArIDIwOwogICAgICAgIHRoaXMucmVzZXRJbnB1dEhlaWdodCgpOwogICAgICB9LAogICAgICByZXNldElucHV0SGVpZ2h0OiBmdW5jdGlvbiByZXNldElucHV0SGVpZ2h0KCkgewogICAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMuY29sbGFwc2VUYWdzICYmICF0aGlzLmZpbHRlcmFibGUpIHJldHVybjsKICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIV90aGlzMTAuJHJlZnMucmVmZXJlbmNlKSByZXR1cm47CiAgICAgICAgICB2YXIgaW5wdXRDaGlsZE5vZGVzID0gX3RoaXMxMC4kcmVmcy5yZWZlcmVuY2UuJGVsLmNoaWxkTm9kZXM7CiAgICAgICAgICB2YXIgaW5wdXQgPSBbXS5maWx0ZXIuY2FsbChpbnB1dENoaWxkTm9kZXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLnRhZ05hbWUgPT09ICdJTlBVVCc7CiAgICAgICAgICB9KVswXTsKICAgICAgICAgIHZhciB0YWdzID0gX3RoaXMxMC4kcmVmcy50YWdzOwogICAgICAgICAgdmFyIHNpemVJbk1hcCA9IF90aGlzMTAuaW5pdGlhbElucHV0SGVpZ2h0IHx8IDQwOwogICAgICAgICAgaW5wdXQuc3R5bGUuaGVpZ2h0ID0gX3RoaXMxMC5zZWxlY3RlZC5sZW5ndGggPT09IDAgPyBzaXplSW5NYXAgKyAncHgnIDogTWF0aC5tYXgodGFncyA/IHRhZ3MuY2xpZW50SGVpZ2h0ICsgKHRhZ3MuY2xpZW50SGVpZ2h0ID4gc2l6ZUluTWFwID8gNiA6IDApIDogMCwgc2l6ZUluTWFwKSArICdweCc7CgogICAgICAgICAgaWYgKF90aGlzMTAudmlzaWJsZSAmJiBfdGhpczEwLmVtcHR5VGV4dCAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgX3RoaXMxMC5icm9hZGNhc3QoJ0VsU2VsZWN0RHJvcGRvd24nLCAndXBkYXRlUG9wcGVyJyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHJlc2V0SG92ZXJJbmRleDogZnVuY3Rpb24gcmVzZXRIb3ZlckluZGV4KCkgewogICAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIV90aGlzMTEubXVsdGlwbGUpIHsKICAgICAgICAgICAgX3RoaXMxMS5ob3ZlckluZGV4ID0gX3RoaXMxMS5vcHRpb25zLmluZGV4T2YoX3RoaXMxMS5zZWxlY3RlZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoX3RoaXMxMS5zZWxlY3RlZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgX3RoaXMxMS5ob3ZlckluZGV4ID0gTWF0aC5taW4uYXBwbHkobnVsbCwgX3RoaXMxMS5zZWxlY3RlZC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczExLm9wdGlvbnMuaW5kZXhPZihpdGVtKTsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMxMS5ob3ZlckluZGV4ID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCAzMDApOwogICAgICB9LAogICAgICBoYW5kbGVPcHRpb25TZWxlY3Q6IGZ1bmN0aW9uIGhhbmRsZU9wdGlvblNlbGVjdChvcHRpb24sIGJ5Q2xpY2spIHsKICAgICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSAodGhpcy52YWx1ZSB8fCBbXSkuc2xpY2UoKTsKICAgICAgICAgIHZhciBvcHRpb25JbmRleCA9IHRoaXMuZ2V0VmFsdWVJbmRleCh2YWx1ZSwgb3B0aW9uLnZhbHVlKTsKCiAgICAgICAgICBpZiAob3B0aW9uSW5kZXggPiAtMSkgewogICAgICAgICAgICB2YWx1ZS5zcGxpY2Uob3B0aW9uSW5kZXgsIDEpOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm11bHRpcGxlTGltaXQgPD0gMCB8fCB2YWx1ZS5sZW5ndGggPCB0aGlzLm11bHRpcGxlTGltaXQpIHsKICAgICAgICAgICAgdmFsdWUucHVzaChvcHRpb24udmFsdWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdmFsdWUpOwogICAgICAgICAgdGhpcy5lbWl0Q2hhbmdlKHZhbHVlKTsKCiAgICAgICAgICBpZiAob3B0aW9uLmNyZWF0ZWQpIHsKICAgICAgICAgICAgdGhpcy5xdWVyeSA9ICcnOwogICAgICAgICAgICB0aGlzLmhhbmRsZVF1ZXJ5Q2hhbmdlKCcnKTsKICAgICAgICAgICAgdGhpcy5pbnB1dExlbmd0aCA9IDIwOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmZpbHRlcmFibGUpIHRoaXMuJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBvcHRpb24udmFsdWUpOwogICAgICAgICAgdGhpcy5lbWl0Q2hhbmdlKG9wdGlvbi52YWx1ZSk7CiAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuaXNTaWxlbnRCbHVyID0gYnlDbGljazsKICAgICAgICB0aGlzLnNldFNvZnRGb2N1cygpOwogICAgICAgIGlmICh0aGlzLnZpc2libGUpIHJldHVybjsKICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczEyLnNjcm9sbFRvT3B0aW9uKG9wdGlvbik7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNldFNvZnRGb2N1czogZnVuY3Rpb24gc2V0U29mdEZvY3VzKCkgewogICAgICAgIHRoaXMuc29mdEZvY3VzID0gdHJ1ZTsKICAgICAgICB2YXIgaW5wdXQgPSB0aGlzLiRyZWZzLmlucHV0IHx8IHRoaXMuJHJlZnMucmVmZXJlbmNlOwoKICAgICAgICBpZiAoaW5wdXQpIHsKICAgICAgICAgIGlucHV0LmZvY3VzKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBnZXRWYWx1ZUluZGV4OiBmdW5jdGlvbiBnZXRWYWx1ZUluZGV4KCkgewogICAgICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgICAgIHZhciB2YWx1ZSA9IGFyZ3VtZW50c1sxXTsKICAgICAgICB2YXIgaXNPYmplY3QgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpLnRvTG93ZXJDYXNlKCkgPT09ICdbb2JqZWN0IG9iamVjdF0nOwoKICAgICAgICBpZiAoIWlzT2JqZWN0KSB7CiAgICAgICAgICByZXR1cm4gYXJyLmluZGV4T2YodmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgdmFsdWVLZXkgPSB0aGlzLnZhbHVlS2V5OwogICAgICAgICAgdmFyIGluZGV4ID0gLTE7CiAgICAgICAgICBhcnIuc29tZShmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICAgICAgICBpZiAoT2JqZWN0KHV0aWxfWyJnZXRWYWx1ZUJ5UGF0aCJdKShpdGVtLCB2YWx1ZUtleSkgPT09IE9iamVjdCh1dGlsX1siZ2V0VmFsdWVCeVBhdGgiXSkodmFsdWUsIHZhbHVlS2V5KSkgewogICAgICAgICAgICAgIGluZGV4ID0gaTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgfQogICAgICB9LAogICAgICB0b2dnbGVNZW51OiBmdW5jdGlvbiB0b2dnbGVNZW51KCkgewogICAgICAgIGlmICghdGhpcy5zZWxlY3REaXNhYmxlZCkgewogICAgICAgICAgaWYgKHRoaXMubWVudVZpc2libGVPbkZvY3VzKSB7CiAgICAgICAgICAgIHRoaXMubWVudVZpc2libGVPbkZvY3VzID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnZpc2libGUpIHsKICAgICAgICAgICAgKHRoaXMuJHJlZnMuaW5wdXQgfHwgdGhpcy4kcmVmcy5yZWZlcmVuY2UpLmZvY3VzKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBzZWxlY3RPcHRpb246IGZ1bmN0aW9uIHNlbGVjdE9wdGlvbigpIHsKICAgICAgICBpZiAoIXRoaXMudmlzaWJsZSkgewogICAgICAgICAgdGhpcy50b2dnbGVNZW51KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnNbdGhpcy5ob3ZlckluZGV4XSkgewogICAgICAgICAgICB0aGlzLmhhbmRsZU9wdGlvblNlbGVjdCh0aGlzLm9wdGlvbnNbdGhpcy5ob3ZlckluZGV4XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWxldGVTZWxlY3RlZDogZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWQoZXZlbnQpIHsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLm11bHRpcGxlID8gW10gOiAnJzsKICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKTsKICAgICAgICB0aGlzLmVtaXRDaGFuZ2UodmFsdWUpOwogICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlOwogICAgICAgIHRoaXMuJGVtaXQoJ2NsZWFyJyk7CiAgICAgIH0sCiAgICAgIGRlbGV0ZVRhZzogZnVuY3Rpb24gZGVsZXRlVGFnKGV2ZW50LCB0YWcpIHsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLnNlbGVjdGVkLmluZGV4T2YodGFnKTsKCiAgICAgICAgaWYgKGluZGV4ID4gLTEgJiYgIXRoaXMuc2VsZWN0RGlzYWJsZWQpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWUuc2xpY2UoKTsKICAgICAgICAgIHZhbHVlLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKTsKICAgICAgICAgIHRoaXMuZW1pdENoYW5nZSh2YWx1ZSk7CiAgICAgICAgICB0aGlzLiRlbWl0KCdyZW1vdmUtdGFnJywgdGFnLnZhbHVlKTsKICAgICAgICB9CgogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9LAogICAgICBvbklucHV0Q2hhbmdlOiBmdW5jdGlvbiBvbklucHV0Q2hhbmdlKCkgewogICAgICAgIGlmICh0aGlzLmZpbHRlcmFibGUgJiYgdGhpcy5xdWVyeSAhPT0gdGhpcy5zZWxlY3RlZExhYmVsKSB7CiAgICAgICAgICB0aGlzLnF1ZXJ5ID0gdGhpcy5zZWxlY3RlZExhYmVsOwogICAgICAgICAgdGhpcy5oYW5kbGVRdWVyeUNoYW5nZSh0aGlzLnF1ZXJ5KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9uT3B0aW9uRGVzdHJveTogZnVuY3Rpb24gb25PcHRpb25EZXN0cm95KGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgIHRoaXMub3B0aW9uc0NvdW50LS07CiAgICAgICAgICB0aGlzLmZpbHRlcmVkT3B0aW9uc0NvdW50LS07CiAgICAgICAgICB0aGlzLm9wdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJlc2V0SW5wdXRXaWR0aDogZnVuY3Rpb24gcmVzZXRJbnB1dFdpZHRoKCkgewogICAgICAgIHRoaXMuaW5wdXRXaWR0aCA9IHRoaXMuJHJlZnMucmVmZXJlbmNlLiRlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDsKICAgICAgfSwKICAgICAgaGFuZGxlUmVzaXplOiBmdW5jdGlvbiBoYW5kbGVSZXNpemUoKSB7CiAgICAgICAgdGhpcy5yZXNldElucHV0V2lkdGgoKTsKICAgICAgICBpZiAodGhpcy5tdWx0aXBsZSkgdGhpcy5yZXNldElucHV0SGVpZ2h0KCk7CiAgICAgIH0sCiAgICAgIGNoZWNrRGVmYXVsdEZpcnN0T3B0aW9uOiBmdW5jdGlvbiBjaGVja0RlZmF1bHRGaXJzdE9wdGlvbigpIHsKICAgICAgICB0aGlzLmhvdmVySW5kZXggPSAtMTsgLy8gaGlnaGxpZ2h0IHRoZSBjcmVhdGVkIG9wdGlvbgoKICAgICAgICB2YXIgaGFzQ3JlYXRlZCA9IGZhbHNlOwoKICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5vcHRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zW2ldLmNyZWF0ZWQpIHsKICAgICAgICAgICAgaGFzQ3JlYXRlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuaG92ZXJJbmRleCA9IGk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGhhc0NyZWF0ZWQpIHJldHVybjsKCiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSAhPT0gdGhpcy5vcHRpb25zLmxlbmd0aDsgKytfaSkgewogICAgICAgICAgdmFyIG9wdGlvbiA9IHRoaXMub3B0aW9uc1tfaV07CgogICAgICAgICAgaWYgKHRoaXMucXVlcnkpIHsKICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IGZpcnN0IG9wdGlvbnMgdGhhdCBwYXNzZXMgdGhlIGZpbHRlcgogICAgICAgICAgICBpZiAoIW9wdGlvbi5kaXNhYmxlZCAmJiAhb3B0aW9uLmdyb3VwRGlzYWJsZWQgJiYgb3B0aW9uLnZpc2libGUpIHsKICAgICAgICAgICAgICB0aGlzLmhvdmVySW5kZXggPSBfaTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IGN1cnJlbnRseSBzZWxlY3RlZCBvcHRpb24KICAgICAgICAgICAgaWYgKG9wdGlvbi5pdGVtU2VsZWN0ZWQpIHsKICAgICAgICAgICAgICB0aGlzLmhvdmVySW5kZXggPSBfaTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2V0VmFsdWVLZXk6IGZ1bmN0aW9uIGdldFZhbHVlS2V5KGl0ZW0pIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZW0udmFsdWUpLnRvTG93ZXJDYXNlKCkgIT09ICdbb2JqZWN0IG9iamVjdF0nKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIE9iamVjdCh1dGlsX1siZ2V0VmFsdWVCeVBhdGgiXSkoaXRlbS52YWx1ZSwgdGhpcy52YWx1ZUtleSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdGhpcy5jYWNoZWRQbGFjZUhvbGRlciA9IHRoaXMuY3VycmVudFBsYWNlaG9sZGVyID0gdGhpcy5wbGFjZWhvbGRlcjsKCiAgICAgIGlmICh0aGlzLm11bHRpcGxlICYmICFBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpKSB7CiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBbXSk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5tdWx0aXBsZSAmJiBBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpKSB7CiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCAnJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuZGVib3VuY2VkT25JbnB1dENoYW5nZSA9IGRlYm91bmNlX2RlZmF1bHQoKSh0aGlzLmRlYm91bmNlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMy5vbklucHV0Q2hhbmdlKCk7CiAgICAgIH0pOwogICAgICB0aGlzLmRlYm91bmNlZFF1ZXJ5Q2hhbmdlID0gZGVib3VuY2VfZGVmYXVsdCgpKHRoaXMuZGVib3VuY2UsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxMy5oYW5kbGVRdWVyeUNoYW5nZShlLnRhcmdldC52YWx1ZSk7CiAgICAgIH0pOwogICAgICB0aGlzLiRvbignaGFuZGxlT3B0aW9uQ2xpY2snLCB0aGlzLmhhbmRsZU9wdGlvblNlbGVjdCk7CiAgICAgIHRoaXMuJG9uKCdzZXRTZWxlY3RlZCcsIHRoaXMuc2V0U2VsZWN0ZWQpOwogICAgfSwKICAgIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLm11bHRpcGxlICYmIEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkgJiYgdGhpcy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5jdXJyZW50UGxhY2Vob2xkZXIgPSAnJzsKICAgICAgfQoKICAgICAgT2JqZWN0KHJlc2l6ZV9ldmVudF9bImFkZFJlc2l6ZUxpc3RlbmVyIl0pKHRoaXMuJGVsLCB0aGlzLmhhbmRsZVJlc2l6ZSk7CiAgICAgIHZhciByZWZlcmVuY2UgPSB0aGlzLiRyZWZzLnJlZmVyZW5jZTsKCiAgICAgIGlmIChyZWZlcmVuY2UgJiYgcmVmZXJlbmNlLiRlbCkgewogICAgICAgIHZhciBzaXplTWFwID0gewogICAgICAgICAgbWVkaXVtOiAzNiwKICAgICAgICAgIHNtYWxsOiAzMiwKICAgICAgICAgIG1pbmk6IDI4CiAgICAgICAgfTsKICAgICAgICB2YXIgaW5wdXQgPSByZWZlcmVuY2UuJGVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7CiAgICAgICAgdGhpcy5pbml0aWFsSW5wdXRIZWlnaHQgPSBpbnB1dC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgfHwgc2l6ZU1hcFt0aGlzLnNlbGVjdFNpemVdOwogICAgICB9CgogICAgICBpZiAodGhpcy5yZW1vdGUgJiYgdGhpcy5tdWx0aXBsZSkgewogICAgICAgIHRoaXMucmVzZXRJbnB1dEhlaWdodCgpOwogICAgICB9CgogICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHJlZmVyZW5jZSAmJiByZWZlcmVuY2UuJGVsKSB7CiAgICAgICAgICBfdGhpczE0LmlucHV0V2lkdGggPSByZWZlcmVuY2UuJGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuc2V0U2VsZWN0ZWQoKTsKICAgIH0sCiAgICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgICBpZiAodGhpcy4kZWwgJiYgdGhpcy5oYW5kbGVSZXNpemUpIE9iamVjdChyZXNpemVfZXZlbnRfWyJyZW1vdmVSZXNpemVMaXN0ZW5lciJdKSh0aGlzLiRlbCwgdGhpcy5oYW5kbGVSZXNpemUpOwogICAgfQogIH07IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvc2VsZWN0L3NyYy9zZWxlY3QudnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJgoKICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovCgogIHZhciBzcmNfc2VsZWN0dnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfID0gc2VsZWN0dnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3BhY2thZ2VzL3NlbGVjdC9zcmMvc2VsZWN0LnZ1ZQoKICAvKiBub3JtYWxpemUgY29tcG9uZW50ICovCgogIHZhciBzZWxlY3RfY29tcG9uZW50ID0gT2JqZWN0KGNvbXBvbmVudE5vcm1hbGl6ZXJbImEiCiAgLyogZGVmYXVsdCAqLwogIF0pKHNyY19zZWxlY3R2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18sIHJlbmRlciwgc3RhdGljUmVuZGVyRm5zLCBmYWxzZSwgbnVsbCwgbnVsbCwgbnVsbCk7CiAgLyogaG90IHJlbG9hZCAqLwoKICBpZiAoZmFsc2UpIHsKICAgIHZhciBzZWxlY3RfYXBpOwogIH0KCiAgc2VsZWN0X2NvbXBvbmVudC5vcHRpb25zLl9fZmlsZSA9ICJwYWNrYWdlcy9zZWxlY3Qvc3JjL3NlbGVjdC52dWUiOwogIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCiAgdmFyIHNyY19zZWxlY3QgPSBzZWxlY3RfY29tcG9uZW50LmV4cG9ydHM7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvc2VsZWN0L2luZGV4LmpzCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogIHNyY19zZWxlY3QuaW5zdGFsbCA9IGZ1bmN0aW9uIChWdWUpIHsKICAgIFZ1ZS5jb21wb25lbnQoc3JjX3NlbGVjdC5uYW1lLCBzcmNfc2VsZWN0KTsKICB9OwogIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCgogIHZhciBwYWNrYWdlc19zZWxlY3QgPSBfX3dlYnBhY2tfZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBzcmNfc2VsZWN0OwogIC8qKiovCn0KLyoqKioqKi8KXSk7"},null]}