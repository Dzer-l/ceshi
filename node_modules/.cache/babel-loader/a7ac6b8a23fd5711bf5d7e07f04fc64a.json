{"remainingRequest":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/thread-loader/dist/cjs.js!/home/jenkins_data/workspace/页面-公证处后台/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/home/jenkins_data/workspace/页面-公证处后台/node_modules/vuex/dist/vuex.esm.js","dependencies":[{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/vuex/dist/vuex.esm.js","mtime":499162500000},{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jenkins_data/workspace/页面-公证处后台/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgovKioKICogdnVleCB2My4xLjAKICogKGMpIDIwMTkgRXZhbiBZb3UKICogQGxpY2Vuc2UgTUlUCiAqLwpmdW5jdGlvbiBhcHBseU1peGluKFZ1ZSkgewogIHZhciB2ZXJzaW9uID0gTnVtYmVyKFZ1ZS52ZXJzaW9uLnNwbGl0KCcuJylbMF0pOwoKICBpZiAodmVyc2lvbiA+PSAyKSB7CiAgICBWdWUubWl4aW4oewogICAgICBiZWZvcmVDcmVhdGU6IHZ1ZXhJbml0CiAgICB9KTsKICB9IGVsc2UgewogICAgLy8gb3ZlcnJpZGUgaW5pdCBhbmQgaW5qZWN0IHZ1ZXggaW5pdCBwcm9jZWR1cmUKICAgIC8vIGZvciAxLnggYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgICB2YXIgX2luaXQgPSBWdWUucHJvdG90eXBlLl9pbml0OwoKICAgIFZ1ZS5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSBvcHRpb25zID0ge307CiAgICAgIG9wdGlvbnMuaW5pdCA9IG9wdGlvbnMuaW5pdCA/IFt2dWV4SW5pdF0uY29uY2F0KG9wdGlvbnMuaW5pdCkgOiB2dWV4SW5pdDsKCiAgICAgIF9pbml0LmNhbGwodGhpcywgb3B0aW9ucyk7CiAgICB9OwogIH0KICAvKioKICAgKiBWdWV4IGluaXQgaG9vaywgaW5qZWN0ZWQgaW50byBlYWNoIGluc3RhbmNlcyBpbml0IGhvb2tzIGxpc3QuCiAgICovCgoKICBmdW5jdGlvbiB2dWV4SW5pdCgpIHsKICAgIHZhciBvcHRpb25zID0gdGhpcy4kb3B0aW9uczsgLy8gc3RvcmUgaW5qZWN0aW9uCgogICAgaWYgKG9wdGlvbnMuc3RvcmUpIHsKICAgICAgdGhpcy4kc3RvcmUgPSB0eXBlb2Ygb3B0aW9ucy5zdG9yZSA9PT0gJ2Z1bmN0aW9uJyA/IG9wdGlvbnMuc3RvcmUoKSA6IG9wdGlvbnMuc3RvcmU7CiAgICB9IGVsc2UgaWYgKG9wdGlvbnMucGFyZW50ICYmIG9wdGlvbnMucGFyZW50LiRzdG9yZSkgewogICAgICB0aGlzLiRzdG9yZSA9IG9wdGlvbnMucGFyZW50LiRzdG9yZTsKICAgIH0KICB9Cn0KCnZhciBkZXZ0b29sSG9vayA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5fX1ZVRV9ERVZUT09MU19HTE9CQUxfSE9PS19fOwoKZnVuY3Rpb24gZGV2dG9vbFBsdWdpbihzdG9yZSkgewogIGlmICghZGV2dG9vbEhvb2spIHsKICAgIHJldHVybjsKICB9CgogIHN0b3JlLl9kZXZ0b29sSG9vayA9IGRldnRvb2xIb29rOwogIGRldnRvb2xIb29rLmVtaXQoJ3Z1ZXg6aW5pdCcsIHN0b3JlKTsKICBkZXZ0b29sSG9vay5vbigndnVleDp0cmF2ZWwtdG8tc3RhdGUnLCBmdW5jdGlvbiAodGFyZ2V0U3RhdGUpIHsKICAgIHN0b3JlLnJlcGxhY2VTdGF0ZSh0YXJnZXRTdGF0ZSk7CiAgfSk7CiAgc3RvcmUuc3Vic2NyaWJlKGZ1bmN0aW9uIChtdXRhdGlvbiwgc3RhdGUpIHsKICAgIGRldnRvb2xIb29rLmVtaXQoJ3Z1ZXg6bXV0YXRpb24nLCBtdXRhdGlvbiwgc3RhdGUpOwogIH0pOwp9Ci8qKgogKiBHZXQgdGhlIGZpcnN0IGl0ZW0gdGhhdCBwYXNzIHRoZSB0ZXN0CiAqIGJ5IHNlY29uZCBhcmd1bWVudCBmdW5jdGlvbgogKgogKiBAcGFyYW0ge0FycmF5fSBsaXN0CiAqIEBwYXJhbSB7RnVuY3Rpb259IGYKICogQHJldHVybiB7Kn0KICovCgovKioKICogZm9yRWFjaCBmb3Igb2JqZWN0CiAqLwoKCmZ1bmN0aW9uIGZvckVhY2hWYWx1ZShvYmosIGZuKSB7CiAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgIHJldHVybiBmbihvYmpba2V5XSwga2V5KTsKICB9KTsKfQoKZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7CiAgcmV0dXJuIG9iaiAhPT0gbnVsbCAmJiBfdHlwZW9mKG9iaikgPT09ICdvYmplY3QnOwp9CgpmdW5jdGlvbiBpc1Byb21pc2UodmFsKSB7CiAgcmV0dXJuIHZhbCAmJiB0eXBlb2YgdmFsLnRoZW4gPT09ICdmdW5jdGlvbic7Cn0KCmZ1bmN0aW9uIGFzc2VydChjb25kaXRpb24sIG1zZykgewogIGlmICghY29uZGl0aW9uKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlt2dWV4XSAiICsgbXNnKTsKICB9Cn0gLy8gQmFzZSBkYXRhIHN0cnVjdCBmb3Igc3RvcmUncyBtb2R1bGUsIHBhY2thZ2Ugd2l0aCBzb21lIGF0dHJpYnV0ZSBhbmQgbWV0aG9kCgoKdmFyIE1vZHVsZSA9IGZ1bmN0aW9uIE1vZHVsZShyYXdNb2R1bGUsIHJ1bnRpbWUpIHsKICB0aGlzLnJ1bnRpbWUgPSBydW50aW1lOyAvLyBTdG9yZSBzb21lIGNoaWxkcmVuIGl0ZW0KCiAgdGhpcy5fY2hpbGRyZW4gPSBPYmplY3QuY3JlYXRlKG51bGwpOyAvLyBTdG9yZSB0aGUgb3JpZ2luIG1vZHVsZSBvYmplY3Qgd2hpY2ggcGFzc2VkIGJ5IHByb2dyYW1tZXIKCiAgdGhpcy5fcmF3TW9kdWxlID0gcmF3TW9kdWxlOwogIHZhciByYXdTdGF0ZSA9IHJhd01vZHVsZS5zdGF0ZTsgLy8gU3RvcmUgdGhlIG9yaWdpbiBtb2R1bGUncyBzdGF0ZQoKICB0aGlzLnN0YXRlID0gKHR5cGVvZiByYXdTdGF0ZSA9PT0gJ2Z1bmN0aW9uJyA/IHJhd1N0YXRlKCkgOiByYXdTdGF0ZSkgfHwge307Cn07Cgp2YXIgcHJvdG90eXBlQWNjZXNzb3JzID0gewogIG5hbWVzcGFjZWQ6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0KfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5uYW1lc3BhY2VkLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gISF0aGlzLl9yYXdNb2R1bGUubmFtZXNwYWNlZDsKfTsKCk1vZHVsZS5wcm90b3R5cGUuYWRkQ2hpbGQgPSBmdW5jdGlvbiBhZGRDaGlsZChrZXksIG1vZHVsZSkgewogIHRoaXMuX2NoaWxkcmVuW2tleV0gPSBtb2R1bGU7Cn07CgpNb2R1bGUucHJvdG90eXBlLnJlbW92ZUNoaWxkID0gZnVuY3Rpb24gcmVtb3ZlQ2hpbGQoa2V5KSB7CiAgZGVsZXRlIHRoaXMuX2NoaWxkcmVuW2tleV07Cn07CgpNb2R1bGUucHJvdG90eXBlLmdldENoaWxkID0gZnVuY3Rpb24gZ2V0Q2hpbGQoa2V5KSB7CiAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuW2tleV07Cn07CgpNb2R1bGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZShyYXdNb2R1bGUpIHsKICB0aGlzLl9yYXdNb2R1bGUubmFtZXNwYWNlZCA9IHJhd01vZHVsZS5uYW1lc3BhY2VkOwoKICBpZiAocmF3TW9kdWxlLmFjdGlvbnMpIHsKICAgIHRoaXMuX3Jhd01vZHVsZS5hY3Rpb25zID0gcmF3TW9kdWxlLmFjdGlvbnM7CiAgfQoKICBpZiAocmF3TW9kdWxlLm11dGF0aW9ucykgewogICAgdGhpcy5fcmF3TW9kdWxlLm11dGF0aW9ucyA9IHJhd01vZHVsZS5tdXRhdGlvbnM7CiAgfQoKICBpZiAocmF3TW9kdWxlLmdldHRlcnMpIHsKICAgIHRoaXMuX3Jhd01vZHVsZS5nZXR0ZXJzID0gcmF3TW9kdWxlLmdldHRlcnM7CiAgfQp9OwoKTW9kdWxlLnByb3RvdHlwZS5mb3JFYWNoQ2hpbGQgPSBmdW5jdGlvbiBmb3JFYWNoQ2hpbGQoZm4pIHsKICBmb3JFYWNoVmFsdWUodGhpcy5fY2hpbGRyZW4sIGZuKTsKfTsKCk1vZHVsZS5wcm90b3R5cGUuZm9yRWFjaEdldHRlciA9IGZ1bmN0aW9uIGZvckVhY2hHZXR0ZXIoZm4pIHsKICBpZiAodGhpcy5fcmF3TW9kdWxlLmdldHRlcnMpIHsKICAgIGZvckVhY2hWYWx1ZSh0aGlzLl9yYXdNb2R1bGUuZ2V0dGVycywgZm4pOwogIH0KfTsKCk1vZHVsZS5wcm90b3R5cGUuZm9yRWFjaEFjdGlvbiA9IGZ1bmN0aW9uIGZvckVhY2hBY3Rpb24oZm4pIHsKICBpZiAodGhpcy5fcmF3TW9kdWxlLmFjdGlvbnMpIHsKICAgIGZvckVhY2hWYWx1ZSh0aGlzLl9yYXdNb2R1bGUuYWN0aW9ucywgZm4pOwogIH0KfTsKCk1vZHVsZS5wcm90b3R5cGUuZm9yRWFjaE11dGF0aW9uID0gZnVuY3Rpb24gZm9yRWFjaE11dGF0aW9uKGZuKSB7CiAgaWYgKHRoaXMuX3Jhd01vZHVsZS5tdXRhdGlvbnMpIHsKICAgIGZvckVhY2hWYWx1ZSh0aGlzLl9yYXdNb2R1bGUubXV0YXRpb25zLCBmbik7CiAgfQp9OwoKT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTW9kdWxlLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzKTsKCnZhciBNb2R1bGVDb2xsZWN0aW9uID0gZnVuY3Rpb24gTW9kdWxlQ29sbGVjdGlvbihyYXdSb290TW9kdWxlKSB7CiAgLy8gcmVnaXN0ZXIgcm9vdCBtb2R1bGUgKFZ1ZXguU3RvcmUgb3B0aW9ucykKICB0aGlzLnJlZ2lzdGVyKFtdLCByYXdSb290TW9kdWxlLCBmYWxzZSk7Cn07CgpNb2R1bGVDb2xsZWN0aW9uLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQocGF0aCkgewogIHJldHVybiBwYXRoLnJlZHVjZShmdW5jdGlvbiAobW9kdWxlLCBrZXkpIHsKICAgIHJldHVybiBtb2R1bGUuZ2V0Q2hpbGQoa2V5KTsKICB9LCB0aGlzLnJvb3QpOwp9OwoKTW9kdWxlQ29sbGVjdGlvbi5wcm90b3R5cGUuZ2V0TmFtZXNwYWNlID0gZnVuY3Rpb24gZ2V0TmFtZXNwYWNlKHBhdGgpIHsKICB2YXIgbW9kdWxlID0gdGhpcy5yb290OwogIHJldHVybiBwYXRoLnJlZHVjZShmdW5jdGlvbiAobmFtZXNwYWNlLCBrZXkpIHsKICAgIG1vZHVsZSA9IG1vZHVsZS5nZXRDaGlsZChrZXkpOwogICAgcmV0dXJuIG5hbWVzcGFjZSArIChtb2R1bGUubmFtZXNwYWNlZCA/IGtleSArICcvJyA6ICcnKTsKICB9LCAnJyk7Cn07CgpNb2R1bGVDb2xsZWN0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUkMShyYXdSb290TW9kdWxlKSB7CiAgdXBkYXRlKFtdLCB0aGlzLnJvb3QsIHJhd1Jvb3RNb2R1bGUpOwp9OwoKTW9kdWxlQ29sbGVjdGlvbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihwYXRoLCByYXdNb2R1bGUsIHJ1bnRpbWUpIHsKICB2YXIgdGhpcyQxID0gdGhpczsKICBpZiAocnVudGltZSA9PT0gdm9pZCAwKSBydW50aW1lID0gdHJ1ZTsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIGFzc2VydFJhd01vZHVsZShwYXRoLCByYXdNb2R1bGUpOwogIH0KCiAgdmFyIG5ld01vZHVsZSA9IG5ldyBNb2R1bGUocmF3TW9kdWxlLCBydW50aW1lKTsKCiAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSB7CiAgICB0aGlzLnJvb3QgPSBuZXdNb2R1bGU7CiAgfSBlbHNlIHsKICAgIHZhciBwYXJlbnQgPSB0aGlzLmdldChwYXRoLnNsaWNlKDAsIC0xKSk7CiAgICBwYXJlbnQuYWRkQ2hpbGQocGF0aFtwYXRoLmxlbmd0aCAtIDFdLCBuZXdNb2R1bGUpOwogIH0gLy8gcmVnaXN0ZXIgbmVzdGVkIG1vZHVsZXMKCgogIGlmIChyYXdNb2R1bGUubW9kdWxlcykgewogICAgZm9yRWFjaFZhbHVlKHJhd01vZHVsZS5tb2R1bGVzLCBmdW5jdGlvbiAocmF3Q2hpbGRNb2R1bGUsIGtleSkgewogICAgICB0aGlzJDEucmVnaXN0ZXIocGF0aC5jb25jYXQoa2V5KSwgcmF3Q2hpbGRNb2R1bGUsIHJ1bnRpbWUpOwogICAgfSk7CiAgfQp9OwoKTW9kdWxlQ29sbGVjdGlvbi5wcm90b3R5cGUudW5yZWdpc3RlciA9IGZ1bmN0aW9uIHVucmVnaXN0ZXIocGF0aCkgewogIHZhciBwYXJlbnQgPSB0aGlzLmdldChwYXRoLnNsaWNlKDAsIC0xKSk7CiAgdmFyIGtleSA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTsKCiAgaWYgKCFwYXJlbnQuZ2V0Q2hpbGQoa2V5KS5ydW50aW1lKSB7CiAgICByZXR1cm47CiAgfQoKICBwYXJlbnQucmVtb3ZlQ2hpbGQoa2V5KTsKfTsKCmZ1bmN0aW9uIHVwZGF0ZShwYXRoLCB0YXJnZXRNb2R1bGUsIG5ld01vZHVsZSkgewogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICBhc3NlcnRSYXdNb2R1bGUocGF0aCwgbmV3TW9kdWxlKTsKICB9IC8vIHVwZGF0ZSB0YXJnZXQgbW9kdWxlCgoKICB0YXJnZXRNb2R1bGUudXBkYXRlKG5ld01vZHVsZSk7IC8vIHVwZGF0ZSBuZXN0ZWQgbW9kdWxlcwoKICBpZiAobmV3TW9kdWxlLm1vZHVsZXMpIHsKICAgIGZvciAodmFyIGtleSBpbiBuZXdNb2R1bGUubW9kdWxlcykgewogICAgICBpZiAoIXRhcmdldE1vZHVsZS5nZXRDaGlsZChrZXkpKSB7CiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiW3Z1ZXhdIHRyeWluZyB0byBhZGQgYSBuZXcgbW9kdWxlICciICsga2V5ICsgIicgb24gaG90IHJlbG9hZGluZywgIiArICdtYW51YWwgcmVsb2FkIGlzIG5lZWRlZCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB1cGRhdGUocGF0aC5jb25jYXQoa2V5KSwgdGFyZ2V0TW9kdWxlLmdldENoaWxkKGtleSksIG5ld01vZHVsZS5tb2R1bGVzW2tleV0pOwogICAgfQogIH0KfQoKdmFyIGZ1bmN0aW9uQXNzZXJ0ID0gewogIGFzc2VydDogZnVuY3Rpb24gYXNzZXJ0KHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nOwogIH0sCiAgZXhwZWN0ZWQ6ICdmdW5jdGlvbicKfTsKdmFyIG9iamVjdEFzc2VydCA9IHsKICBhc3NlcnQ6IGZ1bmN0aW9uIGFzc2VydCh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyB8fCBfdHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHZhbHVlLmhhbmRsZXIgPT09ICdmdW5jdGlvbic7CiAgfSwKICBleHBlY3RlZDogJ2Z1bmN0aW9uIG9yIG9iamVjdCB3aXRoICJoYW5kbGVyIiBmdW5jdGlvbicKfTsKdmFyIGFzc2VydFR5cGVzID0gewogIGdldHRlcnM6IGZ1bmN0aW9uQXNzZXJ0LAogIG11dGF0aW9uczogZnVuY3Rpb25Bc3NlcnQsCiAgYWN0aW9uczogb2JqZWN0QXNzZXJ0Cn07CgpmdW5jdGlvbiBhc3NlcnRSYXdNb2R1bGUocGF0aCwgcmF3TW9kdWxlKSB7CiAgT2JqZWN0LmtleXMoYXNzZXJ0VHlwZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgaWYgKCFyYXdNb2R1bGVba2V5XSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGFzc2VydE9wdGlvbnMgPSBhc3NlcnRUeXBlc1trZXldOwogICAgZm9yRWFjaFZhbHVlKHJhd01vZHVsZVtrZXldLCBmdW5jdGlvbiAodmFsdWUsIHR5cGUpIHsKICAgICAgYXNzZXJ0KGFzc2VydE9wdGlvbnMuYXNzZXJ0KHZhbHVlKSwgbWFrZUFzc2VydGlvbk1lc3NhZ2UocGF0aCwga2V5LCB0eXBlLCB2YWx1ZSwgYXNzZXJ0T3B0aW9ucy5leHBlY3RlZCkpOwogICAgfSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIG1ha2VBc3NlcnRpb25NZXNzYWdlKHBhdGgsIGtleSwgdHlwZSwgdmFsdWUsIGV4cGVjdGVkKSB7CiAgdmFyIGJ1ZiA9IGtleSArICIgc2hvdWxkIGJlICIgKyBleHBlY3RlZCArICIgYnV0IFwiIiArIGtleSArICIuIiArIHR5cGUgKyAiXCIiOwoKICBpZiAocGF0aC5sZW5ndGggPiAwKSB7CiAgICBidWYgKz0gIiBpbiBtb2R1bGUgXCIiICsgcGF0aC5qb2luKCcuJykgKyAiXCIiOwogIH0KCiAgYnVmICs9ICIgaXMgIiArIEpTT04uc3RyaW5naWZ5KHZhbHVlKSArICIuIjsKICByZXR1cm4gYnVmOwp9Cgp2YXIgVnVlOyAvLyBiaW5kIG9uIGluc3RhbGwKCnZhciBTdG9yZSA9IGZ1bmN0aW9uIFN0b3JlKG9wdGlvbnMpIHsKICB2YXIgdGhpcyQxID0gdGhpczsKICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSBvcHRpb25zID0ge307IC8vIEF1dG8gaW5zdGFsbCBpZiBpdCBpcyBub3QgZG9uZSB5ZXQgYW5kIGB3aW5kb3dgIGhhcyBgVnVlYC4KICAvLyBUbyBhbGxvdyB1c2VycyB0byBhdm9pZCBhdXRvLWluc3RhbGxhdGlvbiBpbiBzb21lIGNhc2VzLAogIC8vIHRoaXMgY29kZSBzaG91bGQgYmUgcGxhY2VkIGhlcmUuIFNlZSAjNzMxCgogIGlmICghVnVlICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WdWUpIHsKICAgIGluc3RhbGwod2luZG93LlZ1ZSk7CiAgfQoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgYXNzZXJ0KFZ1ZSwgIm11c3QgY2FsbCBWdWUudXNlKFZ1ZXgpIGJlZm9yZSBjcmVhdGluZyBhIHN0b3JlIGluc3RhbmNlLiIpOwogICAgYXNzZXJ0KHR5cGVvZiBQcm9taXNlICE9PSAndW5kZWZpbmVkJywgInZ1ZXggcmVxdWlyZXMgYSBQcm9taXNlIHBvbHlmaWxsIGluIHRoaXMgYnJvd3Nlci4iKTsKICAgIGFzc2VydCh0aGlzIGluc3RhbmNlb2YgU3RvcmUsICJzdG9yZSBtdXN0IGJlIGNhbGxlZCB3aXRoIHRoZSBuZXcgb3BlcmF0b3IuIik7CiAgfQoKICB2YXIgcGx1Z2lucyA9IG9wdGlvbnMucGx1Z2luczsKICBpZiAocGx1Z2lucyA9PT0gdm9pZCAwKSBwbHVnaW5zID0gW107CiAgdmFyIHN0cmljdCA9IG9wdGlvbnMuc3RyaWN0OwogIGlmIChzdHJpY3QgPT09IHZvaWQgMCkgc3RyaWN0ID0gZmFsc2U7IC8vIHN0b3JlIGludGVybmFsIHN0YXRlCgogIHRoaXMuX2NvbW1pdHRpbmcgPSBmYWxzZTsKICB0aGlzLl9hY3Rpb25zID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB0aGlzLl9hY3Rpb25TdWJzY3JpYmVycyA9IFtdOwogIHRoaXMuX211dGF0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgdGhpcy5fd3JhcHBlZEdldHRlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIHRoaXMuX21vZHVsZXMgPSBuZXcgTW9kdWxlQ29sbGVjdGlvbihvcHRpb25zKTsKICB0aGlzLl9tb2R1bGVzTmFtZXNwYWNlTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB0aGlzLl9zdWJzY3JpYmVycyA9IFtdOwogIHRoaXMuX3dhdGNoZXJWTSA9IG5ldyBWdWUoKTsgLy8gYmluZCBjb21taXQgYW5kIGRpc3BhdGNoIHRvIHNlbGYKCiAgdmFyIHN0b3JlID0gdGhpczsKICB2YXIgcmVmID0gdGhpczsKICB2YXIgZGlzcGF0Y2ggPSByZWYuZGlzcGF0Y2g7CiAgdmFyIGNvbW1pdCA9IHJlZi5jb21taXQ7CgogIHRoaXMuZGlzcGF0Y2ggPSBmdW5jdGlvbiBib3VuZERpc3BhdGNoKHR5cGUsIHBheWxvYWQpIHsKICAgIHJldHVybiBkaXNwYXRjaC5jYWxsKHN0b3JlLCB0eXBlLCBwYXlsb2FkKTsKICB9OwoKICB0aGlzLmNvbW1pdCA9IGZ1bmN0aW9uIGJvdW5kQ29tbWl0KHR5cGUsIHBheWxvYWQsIG9wdGlvbnMpIHsKICAgIHJldHVybiBjb21taXQuY2FsbChzdG9yZSwgdHlwZSwgcGF5bG9hZCwgb3B0aW9ucyk7CiAgfTsgLy8gc3RyaWN0IG1vZGUKCgogIHRoaXMuc3RyaWN0ID0gc3RyaWN0OwogIHZhciBzdGF0ZSA9IHRoaXMuX21vZHVsZXMucm9vdC5zdGF0ZTsgLy8gaW5pdCByb290IG1vZHVsZS4KICAvLyB0aGlzIGFsc28gcmVjdXJzaXZlbHkgcmVnaXN0ZXJzIGFsbCBzdWItbW9kdWxlcwogIC8vIGFuZCBjb2xsZWN0cyBhbGwgbW9kdWxlIGdldHRlcnMgaW5zaWRlIHRoaXMuX3dyYXBwZWRHZXR0ZXJzCgogIGluc3RhbGxNb2R1bGUodGhpcywgc3RhdGUsIFtdLCB0aGlzLl9tb2R1bGVzLnJvb3QpOyAvLyBpbml0aWFsaXplIHRoZSBzdG9yZSB2bSwgd2hpY2ggaXMgcmVzcG9uc2libGUgZm9yIHRoZSByZWFjdGl2aXR5CiAgLy8gKGFsc28gcmVnaXN0ZXJzIF93cmFwcGVkR2V0dGVycyBhcyBjb21wdXRlZCBwcm9wZXJ0aWVzKQoKICByZXNldFN0b3JlVk0odGhpcywgc3RhdGUpOyAvLyBhcHBseSBwbHVnaW5zCgogIHBsdWdpbnMuZm9yRWFjaChmdW5jdGlvbiAocGx1Z2luKSB7CiAgICByZXR1cm4gcGx1Z2luKHRoaXMkMSk7CiAgfSk7CiAgdmFyIHVzZURldnRvb2xzID0gb3B0aW9ucy5kZXZ0b29scyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5kZXZ0b29scyA6IFZ1ZS5jb25maWcuZGV2dG9vbHM7CgogIGlmICh1c2VEZXZ0b29scykgewogICAgZGV2dG9vbFBsdWdpbih0aGlzKTsKICB9Cn07Cgp2YXIgcHJvdG90eXBlQWNjZXNzb3JzJDEgPSB7CiAgc3RhdGU6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0KfTsKCnByb3RvdHlwZUFjY2Vzc29ycyQxLnN0YXRlLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fdm0uX2RhdGEuJCRzdGF0ZTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycyQxLnN0YXRlLnNldCA9IGZ1bmN0aW9uICh2KSB7CiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIGFzc2VydChmYWxzZSwgInVzZSBzdG9yZS5yZXBsYWNlU3RhdGUoKSB0byBleHBsaWNpdCByZXBsYWNlIHN0b3JlIHN0YXRlLiIpOwogIH0KfTsKClN0b3JlLnByb3RvdHlwZS5jb21taXQgPSBmdW5jdGlvbiBjb21taXQoX3R5cGUsIF9wYXlsb2FkLCBfb3B0aW9ucykgewogIHZhciB0aGlzJDEgPSB0aGlzOyAvLyBjaGVjayBvYmplY3Qtc3R5bGUgY29tbWl0CgogIHZhciByZWYgPSB1bmlmeU9iamVjdFN0eWxlKF90eXBlLCBfcGF5bG9hZCwgX29wdGlvbnMpOwogIHZhciB0eXBlID0gcmVmLnR5cGU7CiAgdmFyIHBheWxvYWQgPSByZWYucGF5bG9hZDsKICB2YXIgb3B0aW9ucyA9IHJlZi5vcHRpb25zOwogIHZhciBtdXRhdGlvbiA9IHsKICAgIHR5cGU6IHR5cGUsCiAgICBwYXlsb2FkOiBwYXlsb2FkCiAgfTsKICB2YXIgZW50cnkgPSB0aGlzLl9tdXRhdGlvbnNbdHlwZV07CgogIGlmICghZW50cnkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIlt2dWV4XSB1bmtub3duIG11dGF0aW9uIHR5cGU6ICIgKyB0eXBlKTsKICAgIH0KCiAgICByZXR1cm47CiAgfQoKICB0aGlzLl93aXRoQ29tbWl0KGZ1bmN0aW9uICgpIHsKICAgIGVudHJ5LmZvckVhY2goZnVuY3Rpb24gY29tbWl0SXRlcmF0b3IoaGFuZGxlcikgewogICAgICBoYW5kbGVyKHBheWxvYWQpOwogICAgfSk7CiAgfSk7CgogIHRoaXMuX3N1YnNjcmliZXJzLmZvckVhY2goZnVuY3Rpb24gKHN1YikgewogICAgcmV0dXJuIHN1YihtdXRhdGlvbiwgdGhpcyQxLnN0YXRlKTsKICB9KTsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgb3B0aW9ucyAmJiBvcHRpb25zLnNpbGVudCkgewogICAgY29uc29sZS53YXJuKCJbdnVleF0gbXV0YXRpb24gdHlwZTogIiArIHR5cGUgKyAiLiBTaWxlbnQgb3B0aW9uIGhhcyBiZWVuIHJlbW92ZWQuICIgKyAnVXNlIHRoZSBmaWx0ZXIgZnVuY3Rpb25hbGl0eSBpbiB0aGUgdnVlLWRldnRvb2xzJyk7CiAgfQp9OwoKU3RvcmUucHJvdG90eXBlLmRpc3BhdGNoID0gZnVuY3Rpb24gZGlzcGF0Y2goX3R5cGUsIF9wYXlsb2FkKSB7CiAgdmFyIHRoaXMkMSA9IHRoaXM7IC8vIGNoZWNrIG9iamVjdC1zdHlsZSBkaXNwYXRjaAoKICB2YXIgcmVmID0gdW5pZnlPYmplY3RTdHlsZShfdHlwZSwgX3BheWxvYWQpOwogIHZhciB0eXBlID0gcmVmLnR5cGU7CiAgdmFyIHBheWxvYWQgPSByZWYucGF5bG9hZDsKICB2YXIgYWN0aW9uID0gewogICAgdHlwZTogdHlwZSwKICAgIHBheWxvYWQ6IHBheWxvYWQKICB9OwogIHZhciBlbnRyeSA9IHRoaXMuX2FjdGlvbnNbdHlwZV07CgogIGlmICghZW50cnkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIlt2dWV4XSB1bmtub3duIGFjdGlvbiB0eXBlOiAiICsgdHlwZSk7CiAgICB9CgogICAgcmV0dXJuOwogIH0KCiAgdHJ5IHsKICAgIHRoaXMuX2FjdGlvblN1YnNjcmliZXJzLmZpbHRlcihmdW5jdGlvbiAoc3ViKSB7CiAgICAgIHJldHVybiBzdWIuYmVmb3JlOwogICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoc3ViKSB7CiAgICAgIHJldHVybiBzdWIuYmVmb3JlKGFjdGlvbiwgdGhpcyQxLnN0YXRlKTsKICAgIH0pOwogIH0gY2F0Y2ggKGUpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIGNvbnNvbGUud2FybigiW3Z1ZXhdIGVycm9yIGluIGJlZm9yZSBhY3Rpb24gc3Vic2NyaWJlcnM6ICIpOwogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgfQogIH0KCiAgdmFyIHJlc3VsdCA9IGVudHJ5Lmxlbmd0aCA+IDEgPyBQcm9taXNlLmFsbChlbnRyeS5tYXAoZnVuY3Rpb24gKGhhbmRsZXIpIHsKICAgIHJldHVybiBoYW5kbGVyKHBheWxvYWQpOwogIH0pKSA6IGVudHJ5WzBdKHBheWxvYWQpOwogIHJldHVybiByZXN1bHQudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICB0cnkgewogICAgICB0aGlzJDEuX2FjdGlvblN1YnNjcmliZXJzLmZpbHRlcihmdW5jdGlvbiAoc3ViKSB7CiAgICAgICAgcmV0dXJuIHN1Yi5hZnRlcjsKICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoc3ViKSB7CiAgICAgICAgcmV0dXJuIHN1Yi5hZnRlcihhY3Rpb24sIHRoaXMkMS5zdGF0ZSk7CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIGNvbnNvbGUud2FybigiW3Z1ZXhdIGVycm9yIGluIGFmdGVyIGFjdGlvbiBzdWJzY3JpYmVyczogIik7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXM7CiAgfSk7Cn07CgpTdG9yZS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgcmV0dXJuIGdlbmVyaWNTdWJzY3JpYmUoZm4sIHRoaXMuX3N1YnNjcmliZXJzKTsKfTsKClN0b3JlLnByb3RvdHlwZS5zdWJzY3JpYmVBY3Rpb24gPSBmdW5jdGlvbiBzdWJzY3JpYmVBY3Rpb24oZm4pIHsKICB2YXIgc3VicyA9IHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJyA/IHsKICAgIGJlZm9yZTogZm4KICB9IDogZm47CiAgcmV0dXJuIGdlbmVyaWNTdWJzY3JpYmUoc3VicywgdGhpcy5fYWN0aW9uU3Vic2NyaWJlcnMpOwp9OwoKU3RvcmUucHJvdG90eXBlLndhdGNoID0gZnVuY3Rpb24gd2F0Y2goZ2V0dGVyLCBjYiwgb3B0aW9ucykgewogIHZhciB0aGlzJDEgPSB0aGlzOwoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgYXNzZXJ0KHR5cGVvZiBnZXR0ZXIgPT09ICdmdW5jdGlvbicsICJzdG9yZS53YXRjaCBvbmx5IGFjY2VwdHMgYSBmdW5jdGlvbi4iKTsKICB9CgogIHJldHVybiB0aGlzLl93YXRjaGVyVk0uJHdhdGNoKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBnZXR0ZXIodGhpcyQxLnN0YXRlLCB0aGlzJDEuZ2V0dGVycyk7CiAgfSwgY2IsIG9wdGlvbnMpOwp9OwoKU3RvcmUucHJvdG90eXBlLnJlcGxhY2VTdGF0ZSA9IGZ1bmN0aW9uIHJlcGxhY2VTdGF0ZShzdGF0ZSkgewogIHZhciB0aGlzJDEgPSB0aGlzOwoKICB0aGlzLl93aXRoQ29tbWl0KGZ1bmN0aW9uICgpIHsKICAgIHRoaXMkMS5fdm0uX2RhdGEuJCRzdGF0ZSA9IHN0YXRlOwogIH0pOwp9OwoKU3RvcmUucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlID0gZnVuY3Rpb24gcmVnaXN0ZXJNb2R1bGUocGF0aCwgcmF3TW9kdWxlLCBvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgb3B0aW9ucyA9IHt9OwoKICBpZiAodHlwZW9mIHBhdGggPT09ICdzdHJpbmcnKSB7CiAgICBwYXRoID0gW3BhdGhdOwogIH0KCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIGFzc2VydChBcnJheS5pc0FycmF5KHBhdGgpLCAibW9kdWxlIHBhdGggbXVzdCBiZSBhIHN0cmluZyBvciBhbiBBcnJheS4iKTsKICAgIGFzc2VydChwYXRoLmxlbmd0aCA+IDAsICdjYW5ub3QgcmVnaXN0ZXIgdGhlIHJvb3QgbW9kdWxlIGJ5IHVzaW5nIHJlZ2lzdGVyTW9kdWxlLicpOwogIH0KCiAgdGhpcy5fbW9kdWxlcy5yZWdpc3RlcihwYXRoLCByYXdNb2R1bGUpOwoKICBpbnN0YWxsTW9kdWxlKHRoaXMsIHRoaXMuc3RhdGUsIHBhdGgsIHRoaXMuX21vZHVsZXMuZ2V0KHBhdGgpLCBvcHRpb25zLnByZXNlcnZlU3RhdGUpOyAvLyByZXNldCBzdG9yZSB0byB1cGRhdGUgZ2V0dGVycy4uLgoKICByZXNldFN0b3JlVk0odGhpcywgdGhpcy5zdGF0ZSk7Cn07CgpTdG9yZS5wcm90b3R5cGUudW5yZWdpc3Rlck1vZHVsZSA9IGZ1bmN0aW9uIHVucmVnaXN0ZXJNb2R1bGUocGF0aCkgewogIHZhciB0aGlzJDEgPSB0aGlzOwoKICBpZiAodHlwZW9mIHBhdGggPT09ICdzdHJpbmcnKSB7CiAgICBwYXRoID0gW3BhdGhdOwogIH0KCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIGFzc2VydChBcnJheS5pc0FycmF5KHBhdGgpLCAibW9kdWxlIHBhdGggbXVzdCBiZSBhIHN0cmluZyBvciBhbiBBcnJheS4iKTsKICB9CgogIHRoaXMuX21vZHVsZXMudW5yZWdpc3RlcihwYXRoKTsKCiAgdGhpcy5fd2l0aENvbW1pdChmdW5jdGlvbiAoKSB7CiAgICB2YXIgcGFyZW50U3RhdGUgPSBnZXROZXN0ZWRTdGF0ZSh0aGlzJDEuc3RhdGUsIHBhdGguc2xpY2UoMCwgLTEpKTsKICAgIFZ1ZS5kZWxldGUocGFyZW50U3RhdGUsIHBhdGhbcGF0aC5sZW5ndGggLSAxXSk7CiAgfSk7CgogIHJlc2V0U3RvcmUodGhpcyk7Cn07CgpTdG9yZS5wcm90b3R5cGUuaG90VXBkYXRlID0gZnVuY3Rpb24gaG90VXBkYXRlKG5ld09wdGlvbnMpIHsKICB0aGlzLl9tb2R1bGVzLnVwZGF0ZShuZXdPcHRpb25zKTsKCiAgcmVzZXRTdG9yZSh0aGlzLCB0cnVlKTsKfTsKClN0b3JlLnByb3RvdHlwZS5fd2l0aENvbW1pdCA9IGZ1bmN0aW9uIF93aXRoQ29tbWl0KGZuKSB7CiAgdmFyIGNvbW1pdHRpbmcgPSB0aGlzLl9jb21taXR0aW5nOwogIHRoaXMuX2NvbW1pdHRpbmcgPSB0cnVlOwogIGZuKCk7CiAgdGhpcy5fY29tbWl0dGluZyA9IGNvbW1pdHRpbmc7Cn07CgpPYmplY3QuZGVmaW5lUHJvcGVydGllcyhTdG9yZS5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyQxKTsKCmZ1bmN0aW9uIGdlbmVyaWNTdWJzY3JpYmUoZm4sIHN1YnMpIHsKICBpZiAoc3Vicy5pbmRleE9mKGZuKSA8IDApIHsKICAgIHN1YnMucHVzaChmbik7CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIGkgPSBzdWJzLmluZGV4T2YoZm4pOwoKICAgIGlmIChpID4gLTEpIHsKICAgICAgc3Vicy5zcGxpY2UoaSwgMSk7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gcmVzZXRTdG9yZShzdG9yZSwgaG90KSB7CiAgc3RvcmUuX2FjdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIHN0b3JlLl9tdXRhdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIHN0b3JlLl93cmFwcGVkR2V0dGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgc3RvcmUuX21vZHVsZXNOYW1lc3BhY2VNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIHZhciBzdGF0ZSA9IHN0b3JlLnN0YXRlOyAvLyBpbml0IGFsbCBtb2R1bGVzCgogIGluc3RhbGxNb2R1bGUoc3RvcmUsIHN0YXRlLCBbXSwgc3RvcmUuX21vZHVsZXMucm9vdCwgdHJ1ZSk7IC8vIHJlc2V0IHZtCgogIHJlc2V0U3RvcmVWTShzdG9yZSwgc3RhdGUsIGhvdCk7Cn0KCmZ1bmN0aW9uIHJlc2V0U3RvcmVWTShzdG9yZSwgc3RhdGUsIGhvdCkgewogIHZhciBvbGRWbSA9IHN0b3JlLl92bTsgLy8gYmluZCBzdG9yZSBwdWJsaWMgZ2V0dGVycwoKICBzdG9yZS5nZXR0ZXJzID0ge307CiAgdmFyIHdyYXBwZWRHZXR0ZXJzID0gc3RvcmUuX3dyYXBwZWRHZXR0ZXJzOwogIHZhciBjb21wdXRlZCA9IHt9OwogIGZvckVhY2hWYWx1ZSh3cmFwcGVkR2V0dGVycywgZnVuY3Rpb24gKGZuLCBrZXkpIHsKICAgIC8vIHVzZSBjb21wdXRlZCB0byBsZXZlcmFnZSBpdHMgbGF6eS1jYWNoaW5nIG1lY2hhbmlzbQogICAgY29tcHV0ZWRba2V5XSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGZuKHN0b3JlKTsKICAgIH07CgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN0b3JlLmdldHRlcnMsIGtleSwgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gc3RvcmUuX3ZtW2tleV07CiAgICAgIH0sCiAgICAgIGVudW1lcmFibGU6IHRydWUgLy8gZm9yIGxvY2FsIGdldHRlcnMKCiAgICB9KTsKICB9KTsgLy8gdXNlIGEgVnVlIGluc3RhbmNlIHRvIHN0b3JlIHRoZSBzdGF0ZSB0cmVlCiAgLy8gc3VwcHJlc3Mgd2FybmluZ3MganVzdCBpbiBjYXNlIHRoZSB1c2VyIGhhcyBhZGRlZAogIC8vIHNvbWUgZnVua3kgZ2xvYmFsIG1peGlucwoKICB2YXIgc2lsZW50ID0gVnVlLmNvbmZpZy5zaWxlbnQ7CiAgVnVlLmNvbmZpZy5zaWxlbnQgPSB0cnVlOwogIHN0b3JlLl92bSA9IG5ldyBWdWUoewogICAgZGF0YTogewogICAgICAkJHN0YXRlOiBzdGF0ZQogICAgfSwKICAgIGNvbXB1dGVkOiBjb21wdXRlZAogIH0pOwogIFZ1ZS5jb25maWcuc2lsZW50ID0gc2lsZW50OyAvLyBlbmFibGUgc3RyaWN0IG1vZGUgZm9yIG5ldyB2bQoKICBpZiAoc3RvcmUuc3RyaWN0KSB7CiAgICBlbmFibGVTdHJpY3RNb2RlKHN0b3JlKTsKICB9CgogIGlmIChvbGRWbSkgewogICAgaWYgKGhvdCkgewogICAgICAvLyBkaXNwYXRjaCBjaGFuZ2VzIGluIGFsbCBzdWJzY3JpYmVkIHdhdGNoZXJzCiAgICAgIC8vIHRvIGZvcmNlIGdldHRlciByZS1ldmFsdWF0aW9uIGZvciBob3QgcmVsb2FkaW5nLgogICAgICBzdG9yZS5fd2l0aENvbW1pdChmdW5jdGlvbiAoKSB7CiAgICAgICAgb2xkVm0uX2RhdGEuJCRzdGF0ZSA9IG51bGw7CiAgICAgIH0pOwogICAgfQoKICAgIFZ1ZS5uZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBvbGRWbS4kZGVzdHJveSgpOwogICAgfSk7CiAgfQp9CgpmdW5jdGlvbiBpbnN0YWxsTW9kdWxlKHN0b3JlLCByb290U3RhdGUsIHBhdGgsIG1vZHVsZSwgaG90KSB7CiAgdmFyIGlzUm9vdCA9ICFwYXRoLmxlbmd0aDsKCiAgdmFyIG5hbWVzcGFjZSA9IHN0b3JlLl9tb2R1bGVzLmdldE5hbWVzcGFjZShwYXRoKTsgLy8gcmVnaXN0ZXIgaW4gbmFtZXNwYWNlIG1hcAoKCiAgaWYgKG1vZHVsZS5uYW1lc3BhY2VkKSB7CiAgICBzdG9yZS5fbW9kdWxlc05hbWVzcGFjZU1hcFtuYW1lc3BhY2VdID0gbW9kdWxlOwogIH0gLy8gc2V0IHN0YXRlCgoKICBpZiAoIWlzUm9vdCAmJiAhaG90KSB7CiAgICB2YXIgcGFyZW50U3RhdGUgPSBnZXROZXN0ZWRTdGF0ZShyb290U3RhdGUsIHBhdGguc2xpY2UoMCwgLTEpKTsKICAgIHZhciBtb2R1bGVOYW1lID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdOwoKICAgIHN0b3JlLl93aXRoQ29tbWl0KGZ1bmN0aW9uICgpIHsKICAgICAgVnVlLnNldChwYXJlbnRTdGF0ZSwgbW9kdWxlTmFtZSwgbW9kdWxlLnN0YXRlKTsKICAgIH0pOwogIH0KCiAgdmFyIGxvY2FsID0gbW9kdWxlLmNvbnRleHQgPSBtYWtlTG9jYWxDb250ZXh0KHN0b3JlLCBuYW1lc3BhY2UsIHBhdGgpOwogIG1vZHVsZS5mb3JFYWNoTXV0YXRpb24oZnVuY3Rpb24gKG11dGF0aW9uLCBrZXkpIHsKICAgIHZhciBuYW1lc3BhY2VkVHlwZSA9IG5hbWVzcGFjZSArIGtleTsKICAgIHJlZ2lzdGVyTXV0YXRpb24oc3RvcmUsIG5hbWVzcGFjZWRUeXBlLCBtdXRhdGlvbiwgbG9jYWwpOwogIH0pOwogIG1vZHVsZS5mb3JFYWNoQWN0aW9uKGZ1bmN0aW9uIChhY3Rpb24sIGtleSkgewogICAgdmFyIHR5cGUgPSBhY3Rpb24ucm9vdCA/IGtleSA6IG5hbWVzcGFjZSArIGtleTsKICAgIHZhciBoYW5kbGVyID0gYWN0aW9uLmhhbmRsZXIgfHwgYWN0aW9uOwogICAgcmVnaXN0ZXJBY3Rpb24oc3RvcmUsIHR5cGUsIGhhbmRsZXIsIGxvY2FsKTsKICB9KTsKICBtb2R1bGUuZm9yRWFjaEdldHRlcihmdW5jdGlvbiAoZ2V0dGVyLCBrZXkpIHsKICAgIHZhciBuYW1lc3BhY2VkVHlwZSA9IG5hbWVzcGFjZSArIGtleTsKICAgIHJlZ2lzdGVyR2V0dGVyKHN0b3JlLCBuYW1lc3BhY2VkVHlwZSwgZ2V0dGVyLCBsb2NhbCk7CiAgfSk7CiAgbW9kdWxlLmZvckVhY2hDaGlsZChmdW5jdGlvbiAoY2hpbGQsIGtleSkgewogICAgaW5zdGFsbE1vZHVsZShzdG9yZSwgcm9vdFN0YXRlLCBwYXRoLmNvbmNhdChrZXkpLCBjaGlsZCwgaG90KTsKICB9KTsKfQovKioKICogbWFrZSBsb2NhbGl6ZWQgZGlzcGF0Y2gsIGNvbW1pdCwgZ2V0dGVycyBhbmQgc3RhdGUKICogaWYgdGhlcmUgaXMgbm8gbmFtZXNwYWNlLCBqdXN0IHVzZSByb290IG9uZXMKICovCgoKZnVuY3Rpb24gbWFrZUxvY2FsQ29udGV4dChzdG9yZSwgbmFtZXNwYWNlLCBwYXRoKSB7CiAgdmFyIG5vTmFtZXNwYWNlID0gbmFtZXNwYWNlID09PSAnJzsKICB2YXIgbG9jYWwgPSB7CiAgICBkaXNwYXRjaDogbm9OYW1lc3BhY2UgPyBzdG9yZS5kaXNwYXRjaCA6IGZ1bmN0aW9uIChfdHlwZSwgX3BheWxvYWQsIF9vcHRpb25zKSB7CiAgICAgIHZhciBhcmdzID0gdW5pZnlPYmplY3RTdHlsZShfdHlwZSwgX3BheWxvYWQsIF9vcHRpb25zKTsKICAgICAgdmFyIHBheWxvYWQgPSBhcmdzLnBheWxvYWQ7CiAgICAgIHZhciBvcHRpb25zID0gYXJncy5vcHRpb25zOwogICAgICB2YXIgdHlwZSA9IGFyZ3MudHlwZTsKCiAgICAgIGlmICghb3B0aW9ucyB8fCAhb3B0aW9ucy5yb290KSB7CiAgICAgICAgdHlwZSA9IG5hbWVzcGFjZSArIHR5cGU7CgogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICFzdG9yZS5fYWN0aW9uc1t0eXBlXSkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiW3Z1ZXhdIHVua25vd24gbG9jYWwgYWN0aW9uIHR5cGU6ICIgKyBhcmdzLnR5cGUgKyAiLCBnbG9iYWwgdHlwZTogIiArIHR5cGUpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKHR5cGUsIHBheWxvYWQpOwogICAgfSwKICAgIGNvbW1pdDogbm9OYW1lc3BhY2UgPyBzdG9yZS5jb21taXQgOiBmdW5jdGlvbiAoX3R5cGUsIF9wYXlsb2FkLCBfb3B0aW9ucykgewogICAgICB2YXIgYXJncyA9IHVuaWZ5T2JqZWN0U3R5bGUoX3R5cGUsIF9wYXlsb2FkLCBfb3B0aW9ucyk7CiAgICAgIHZhciBwYXlsb2FkID0gYXJncy5wYXlsb2FkOwogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3Mub3B0aW9uczsKICAgICAgdmFyIHR5cGUgPSBhcmdzLnR5cGU7CgogICAgICBpZiAoIW9wdGlvbnMgfHwgIW9wdGlvbnMucm9vdCkgewogICAgICAgIHR5cGUgPSBuYW1lc3BhY2UgKyB0eXBlOwoKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhc3RvcmUuX211dGF0aW9uc1t0eXBlXSkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiW3Z1ZXhdIHVua25vd24gbG9jYWwgbXV0YXRpb24gdHlwZTogIiArIGFyZ3MudHlwZSArICIsIGdsb2JhbCB0eXBlOiAiICsgdHlwZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICBzdG9yZS5jb21taXQodHlwZSwgcGF5bG9hZCwgb3B0aW9ucyk7CiAgICB9CiAgfTsgLy8gZ2V0dGVycyBhbmQgc3RhdGUgb2JqZWN0IG11c3QgYmUgZ290dGVuIGxhemlseQogIC8vIGJlY2F1c2UgdGhleSB3aWxsIGJlIGNoYW5nZWQgYnkgdm0gdXBkYXRlCgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGxvY2FsLCB7CiAgICBnZXR0ZXJzOiB7CiAgICAgIGdldDogbm9OYW1lc3BhY2UgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlLmdldHRlcnM7CiAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG1ha2VMb2NhbEdldHRlcnMoc3RvcmUsIG5hbWVzcGFjZSk7CiAgICAgIH0KICAgIH0sCiAgICBzdGF0ZTogewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gZ2V0TmVzdGVkU3RhdGUoc3RvcmUuc3RhdGUsIHBhdGgpOwogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIGxvY2FsOwp9CgpmdW5jdGlvbiBtYWtlTG9jYWxHZXR0ZXJzKHN0b3JlLCBuYW1lc3BhY2UpIHsKICB2YXIgZ2V0dGVyc1Byb3h5ID0ge307CiAgdmFyIHNwbGl0UG9zID0gbmFtZXNwYWNlLmxlbmd0aDsKICBPYmplY3Qua2V5cyhzdG9yZS5nZXR0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAvLyBza2lwIGlmIHRoZSB0YXJnZXQgZ2V0dGVyIGlzIG5vdCBtYXRjaCB0aGlzIG5hbWVzcGFjZQogICAgaWYgKHR5cGUuc2xpY2UoMCwgc3BsaXRQb3MpICE9PSBuYW1lc3BhY2UpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBleHRyYWN0IGxvY2FsIGdldHRlciB0eXBlCgoKICAgIHZhciBsb2NhbFR5cGUgPSB0eXBlLnNsaWNlKHNwbGl0UG9zKTsgLy8gQWRkIGEgcG9ydCB0byB0aGUgZ2V0dGVycyBwcm94eS4KICAgIC8vIERlZmluZSBhcyBnZXR0ZXIgcHJvcGVydHkgYmVjYXVzZQogICAgLy8gd2UgZG8gbm90IHdhbnQgdG8gZXZhbHVhdGUgdGhlIGdldHRlcnMgaW4gdGhpcyB0aW1lLgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnZXR0ZXJzUHJveHksIGxvY2FsVHlwZSwgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gc3RvcmUuZ2V0dGVyc1t0eXBlXTsKICAgICAgfSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgfSk7CiAgfSk7CiAgcmV0dXJuIGdldHRlcnNQcm94eTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJNdXRhdGlvbihzdG9yZSwgdHlwZSwgaGFuZGxlciwgbG9jYWwpIHsKICB2YXIgZW50cnkgPSBzdG9yZS5fbXV0YXRpb25zW3R5cGVdIHx8IChzdG9yZS5fbXV0YXRpb25zW3R5cGVdID0gW10pOwogIGVudHJ5LnB1c2goZnVuY3Rpb24gd3JhcHBlZE11dGF0aW9uSGFuZGxlcihwYXlsb2FkKSB7CiAgICBoYW5kbGVyLmNhbGwoc3RvcmUsIGxvY2FsLnN0YXRlLCBwYXlsb2FkKTsKICB9KTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJBY3Rpb24oc3RvcmUsIHR5cGUsIGhhbmRsZXIsIGxvY2FsKSB7CiAgdmFyIGVudHJ5ID0gc3RvcmUuX2FjdGlvbnNbdHlwZV0gfHwgKHN0b3JlLl9hY3Rpb25zW3R5cGVdID0gW10pOwogIGVudHJ5LnB1c2goZnVuY3Rpb24gd3JhcHBlZEFjdGlvbkhhbmRsZXIocGF5bG9hZCwgY2IpIHsKICAgIHZhciByZXMgPSBoYW5kbGVyLmNhbGwoc3RvcmUsIHsKICAgICAgZGlzcGF0Y2g6IGxvY2FsLmRpc3BhdGNoLAogICAgICBjb21taXQ6IGxvY2FsLmNvbW1pdCwKICAgICAgZ2V0dGVyczogbG9jYWwuZ2V0dGVycywKICAgICAgc3RhdGU6IGxvY2FsLnN0YXRlLAogICAgICByb290R2V0dGVyczogc3RvcmUuZ2V0dGVycywKICAgICAgcm9vdFN0YXRlOiBzdG9yZS5zdGF0ZQogICAgfSwgcGF5bG9hZCwgY2IpOwoKICAgIGlmICghaXNQcm9taXNlKHJlcykpIHsKICAgICAgcmVzID0gUHJvbWlzZS5yZXNvbHZlKHJlcyk7CiAgICB9CgogICAgaWYgKHN0b3JlLl9kZXZ0b29sSG9vaykgewogICAgICByZXR1cm4gcmVzLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBzdG9yZS5fZGV2dG9vbEhvb2suZW1pdCgndnVleDplcnJvcicsIGVycik7CgogICAgICAgIHRocm93IGVycjsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gcmVzOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiByZWdpc3RlckdldHRlcihzdG9yZSwgdHlwZSwgcmF3R2V0dGVyLCBsb2NhbCkgewogIGlmIChzdG9yZS5fd3JhcHBlZEdldHRlcnNbdHlwZV0pIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIlt2dWV4XSBkdXBsaWNhdGUgZ2V0dGVyIGtleTogIiArIHR5cGUpOwogICAgfQoKICAgIHJldHVybjsKICB9CgogIHN0b3JlLl93cmFwcGVkR2V0dGVyc1t0eXBlXSA9IGZ1bmN0aW9uIHdyYXBwZWRHZXR0ZXIoc3RvcmUpIHsKICAgIHJldHVybiByYXdHZXR0ZXIobG9jYWwuc3RhdGUsIC8vIGxvY2FsIHN0YXRlCiAgICBsb2NhbC5nZXR0ZXJzLCAvLyBsb2NhbCBnZXR0ZXJzCiAgICBzdG9yZS5zdGF0ZSwgLy8gcm9vdCBzdGF0ZQogICAgc3RvcmUuZ2V0dGVycyAvLyByb290IGdldHRlcnMKICAgICk7CiAgfTsKfQoKZnVuY3Rpb24gZW5hYmxlU3RyaWN0TW9kZShzdG9yZSkgewogIHN0b3JlLl92bS4kd2F0Y2goZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuX2RhdGEuJCRzdGF0ZTsKICB9LCBmdW5jdGlvbiAoKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBhc3NlcnQoc3RvcmUuX2NvbW1pdHRpbmcsICJkbyBub3QgbXV0YXRlIHZ1ZXggc3RvcmUgc3RhdGUgb3V0c2lkZSBtdXRhdGlvbiBoYW5kbGVycy4iKTsKICAgIH0KICB9LCB7CiAgICBkZWVwOiB0cnVlLAogICAgc3luYzogdHJ1ZQogIH0pOwp9CgpmdW5jdGlvbiBnZXROZXN0ZWRTdGF0ZShzdGF0ZSwgcGF0aCkgewogIHJldHVybiBwYXRoLmxlbmd0aCA/IHBhdGgucmVkdWNlKGZ1bmN0aW9uIChzdGF0ZSwga2V5KSB7CiAgICByZXR1cm4gc3RhdGVba2V5XTsKICB9LCBzdGF0ZSkgOiBzdGF0ZTsKfQoKZnVuY3Rpb24gdW5pZnlPYmplY3RTdHlsZSh0eXBlLCBwYXlsb2FkLCBvcHRpb25zKSB7CiAgaWYgKGlzT2JqZWN0KHR5cGUpICYmIHR5cGUudHlwZSkgewogICAgb3B0aW9ucyA9IHBheWxvYWQ7CiAgICBwYXlsb2FkID0gdHlwZTsKICAgIHR5cGUgPSB0eXBlLnR5cGU7CiAgfQoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgYXNzZXJ0KHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJywgImV4cGVjdHMgc3RyaW5nIGFzIHRoZSB0eXBlLCBidXQgZm91bmQgIiArIF90eXBlb2YodHlwZSkgKyAiLiIpOwogIH0KCiAgcmV0dXJuIHsKICAgIHR5cGU6IHR5cGUsCiAgICBwYXlsb2FkOiBwYXlsb2FkLAogICAgb3B0aW9uczogb3B0aW9ucwogIH07Cn0KCmZ1bmN0aW9uIGluc3RhbGwoX1Z1ZSkgewogIGlmIChWdWUgJiYgX1Z1ZSA9PT0gVnVlKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBjb25zb2xlLmVycm9yKCdbdnVleF0gYWxyZWFkeSBpbnN0YWxsZWQuIFZ1ZS51c2UoVnVleCkgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IG9uY2UuJyk7CiAgICB9CgogICAgcmV0dXJuOwogIH0KCiAgVnVlID0gX1Z1ZTsKICBhcHBseU1peGluKFZ1ZSk7Cn0KLyoqCiAqIFJlZHVjZSB0aGUgY29kZSB3aGljaCB3cml0dGVuIGluIFZ1ZS5qcyBmb3IgZ2V0dGluZyB0aGUgc3RhdGUuCiAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZXNwYWNlXSAtIE1vZHVsZSdzIG5hbWVzcGFjZQogKiBAcGFyYW0ge09iamVjdHxBcnJheX0gc3RhdGVzICMgT2JqZWN0J3MgaXRlbSBjYW4gYmUgYSBmdW5jdGlvbiB3aGljaCBhY2NlcHQgc3RhdGUgYW5kIGdldHRlcnMgZm9yIHBhcmFtLCB5b3UgY2FuIGRvIHNvbWV0aGluZyBmb3Igc3RhdGUgYW5kIGdldHRlcnMgaW4gaXQuCiAqIEBwYXJhbSB7T2JqZWN0fQogKi8KCgp2YXIgbWFwU3RhdGUgPSBub3JtYWxpemVOYW1lc3BhY2UoZnVuY3Rpb24gKG5hbWVzcGFjZSwgc3RhdGVzKSB7CiAgdmFyIHJlcyA9IHt9OwogIG5vcm1hbGl6ZU1hcChzdGF0ZXMpLmZvckVhY2goZnVuY3Rpb24gKHJlZikgewogICAgdmFyIGtleSA9IHJlZi5rZXk7CiAgICB2YXIgdmFsID0gcmVmLnZhbDsKCiAgICByZXNba2V5XSA9IGZ1bmN0aW9uIG1hcHBlZFN0YXRlKCkgewogICAgICB2YXIgc3RhdGUgPSB0aGlzLiRzdG9yZS5zdGF0ZTsKICAgICAgdmFyIGdldHRlcnMgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzOwoKICAgICAgaWYgKG5hbWVzcGFjZSkgewogICAgICAgIHZhciBtb2R1bGUgPSBnZXRNb2R1bGVCeU5hbWVzcGFjZSh0aGlzLiRzdG9yZSwgJ21hcFN0YXRlJywgbmFtZXNwYWNlKTsKCiAgICAgICAgaWYgKCFtb2R1bGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHN0YXRlID0gbW9kdWxlLmNvbnRleHQuc3RhdGU7CiAgICAgICAgZ2V0dGVycyA9IG1vZHVsZS5jb250ZXh0LmdldHRlcnM7CiAgICAgIH0KCiAgICAgIHJldHVybiB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nID8gdmFsLmNhbGwodGhpcywgc3RhdGUsIGdldHRlcnMpIDogc3RhdGVbdmFsXTsKICAgIH07IC8vIG1hcmsgdnVleCBnZXR0ZXIgZm9yIGRldnRvb2xzCgoKICAgIHJlc1trZXldLnZ1ZXggPSB0cnVlOwogIH0pOwogIHJldHVybiByZXM7Cn0pOwovKioKICogUmVkdWNlIHRoZSBjb2RlIHdoaWNoIHdyaXR0ZW4gaW4gVnVlLmpzIGZvciBjb21taXR0aW5nIHRoZSBtdXRhdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gW25hbWVzcGFjZV0gLSBNb2R1bGUncyBuYW1lc3BhY2UKICogQHBhcmFtIHtPYmplY3R8QXJyYXl9IG11dGF0aW9ucyAjIE9iamVjdCdzIGl0ZW0gY2FuIGJlIGEgZnVuY3Rpb24gd2hpY2ggYWNjZXB0IGBjb21taXRgIGZ1bmN0aW9uIGFzIHRoZSBmaXJzdCBwYXJhbSwgaXQgY2FuIGFjY2VwdCBhbnRob3IgcGFyYW1zLiBZb3UgY2FuIGNvbW1pdCBtdXRhdGlvbiBhbmQgZG8gYW55IG90aGVyIHRoaW5ncyBpbiB0aGlzIGZ1bmN0aW9uLiBzcGVjaWFsbHksIFlvdSBuZWVkIHRvIHBhc3MgYW50aG9yIHBhcmFtcyBmcm9tIHRoZSBtYXBwZWQgZnVuY3Rpb24uCiAqIEByZXR1cm4ge09iamVjdH0KICovCgp2YXIgbWFwTXV0YXRpb25zID0gbm9ybWFsaXplTmFtZXNwYWNlKGZ1bmN0aW9uIChuYW1lc3BhY2UsIG11dGF0aW9ucykgewogIHZhciByZXMgPSB7fTsKICBub3JtYWxpemVNYXAobXV0YXRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChyZWYpIHsKICAgIHZhciBrZXkgPSByZWYua2V5OwogICAgdmFyIHZhbCA9IHJlZi52YWw7CgogICAgcmVzW2tleV0gPSBmdW5jdGlvbiBtYXBwZWRNdXRhdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgogICAgICB3aGlsZSAobGVuLS0pIHsKICAgICAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuXTsKICAgICAgfSAvLyBHZXQgdGhlIGNvbW1pdCBtZXRob2QgZnJvbSBzdG9yZQoKCiAgICAgIHZhciBjb21taXQgPSB0aGlzLiRzdG9yZS5jb21taXQ7CgogICAgICBpZiAobmFtZXNwYWNlKSB7CiAgICAgICAgdmFyIG1vZHVsZSA9IGdldE1vZHVsZUJ5TmFtZXNwYWNlKHRoaXMuJHN0b3JlLCAnbWFwTXV0YXRpb25zJywgbmFtZXNwYWNlKTsKCiAgICAgICAgaWYgKCFtb2R1bGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbW1pdCA9IG1vZHVsZS5jb250ZXh0LmNvbW1pdDsKICAgICAgfQoKICAgICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbicgPyB2YWwuYXBwbHkodGhpcywgW2NvbW1pdF0uY29uY2F0KGFyZ3MpKSA6IGNvbW1pdC5hcHBseSh0aGlzLiRzdG9yZSwgW3ZhbF0uY29uY2F0KGFyZ3MpKTsKICAgIH07CiAgfSk7CiAgcmV0dXJuIHJlczsKfSk7Ci8qKgogKiBSZWR1Y2UgdGhlIGNvZGUgd2hpY2ggd3JpdHRlbiBpbiBWdWUuanMgZm9yIGdldHRpbmcgdGhlIGdldHRlcnMKICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lc3BhY2VdIC0gTW9kdWxlJ3MgbmFtZXNwYWNlCiAqIEBwYXJhbSB7T2JqZWN0fEFycmF5fSBnZXR0ZXJzCiAqIEByZXR1cm4ge09iamVjdH0KICovCgp2YXIgbWFwR2V0dGVycyA9IG5vcm1hbGl6ZU5hbWVzcGFjZShmdW5jdGlvbiAobmFtZXNwYWNlLCBnZXR0ZXJzKSB7CiAgdmFyIHJlcyA9IHt9OwogIG5vcm1hbGl6ZU1hcChnZXR0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChyZWYpIHsKICAgIHZhciBrZXkgPSByZWYua2V5OwogICAgdmFyIHZhbCA9IHJlZi52YWw7IC8vIFRoZSBuYW1lc3BhY2UgaGFzIGJlZW4gbXV0YXRlZCBieSBub3JtYWxpemVOYW1lc3BhY2UKCiAgICB2YWwgPSBuYW1lc3BhY2UgKyB2YWw7CgogICAgcmVzW2tleV0gPSBmdW5jdGlvbiBtYXBwZWRHZXR0ZXIoKSB7CiAgICAgIGlmIChuYW1lc3BhY2UgJiYgIWdldE1vZHVsZUJ5TmFtZXNwYWNlKHRoaXMuJHN0b3JlLCAnbWFwR2V0dGVycycsIG5hbWVzcGFjZSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICEodmFsIGluIHRoaXMuJHN0b3JlLmdldHRlcnMpKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiW3Z1ZXhdIHVua25vd24gZ2V0dGVyOiAiICsgdmFsKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5nZXR0ZXJzW3ZhbF07CiAgICB9OyAvLyBtYXJrIHZ1ZXggZ2V0dGVyIGZvciBkZXZ0b29scwoKCiAgICByZXNba2V5XS52dWV4ID0gdHJ1ZTsKICB9KTsKICByZXR1cm4gcmVzOwp9KTsKLyoqCiAqIFJlZHVjZSB0aGUgY29kZSB3aGljaCB3cml0dGVuIGluIFZ1ZS5qcyBmb3IgZGlzcGF0Y2ggdGhlIGFjdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gW25hbWVzcGFjZV0gLSBNb2R1bGUncyBuYW1lc3BhY2UKICogQHBhcmFtIHtPYmplY3R8QXJyYXl9IGFjdGlvbnMgIyBPYmplY3QncyBpdGVtIGNhbiBiZSBhIGZ1bmN0aW9uIHdoaWNoIGFjY2VwdCBgZGlzcGF0Y2hgIGZ1bmN0aW9uIGFzIHRoZSBmaXJzdCBwYXJhbSwgaXQgY2FuIGFjY2VwdCBhbnRob3IgcGFyYW1zLiBZb3UgY2FuIGRpc3BhdGNoIGFjdGlvbiBhbmQgZG8gYW55IG90aGVyIHRoaW5ncyBpbiB0aGlzIGZ1bmN0aW9uLiBzcGVjaWFsbHksIFlvdSBuZWVkIHRvIHBhc3MgYW50aG9yIHBhcmFtcyBmcm9tIHRoZSBtYXBwZWQgZnVuY3Rpb24uCiAqIEByZXR1cm4ge09iamVjdH0KICovCgp2YXIgbWFwQWN0aW9ucyA9IG5vcm1hbGl6ZU5hbWVzcGFjZShmdW5jdGlvbiAobmFtZXNwYWNlLCBhY3Rpb25zKSB7CiAgdmFyIHJlcyA9IHt9OwogIG5vcm1hbGl6ZU1hcChhY3Rpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChyZWYpIHsKICAgIHZhciBrZXkgPSByZWYua2V5OwogICAgdmFyIHZhbCA9IHJlZi52YWw7CgogICAgcmVzW2tleV0gPSBmdW5jdGlvbiBtYXBwZWRBY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gW10sCiAgICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgd2hpbGUgKGxlbi0tKSB7CiAgICAgICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbl07CiAgICAgIH0gLy8gZ2V0IGRpc3BhdGNoIGZ1bmN0aW9uIGZyb20gc3RvcmUKCgogICAgICB2YXIgZGlzcGF0Y2ggPSB0aGlzLiRzdG9yZS5kaXNwYXRjaDsKCiAgICAgIGlmIChuYW1lc3BhY2UpIHsKICAgICAgICB2YXIgbW9kdWxlID0gZ2V0TW9kdWxlQnlOYW1lc3BhY2UodGhpcy4kc3RvcmUsICdtYXBBY3Rpb25zJywgbmFtZXNwYWNlKTsKCiAgICAgICAgaWYgKCFtb2R1bGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGRpc3BhdGNoID0gbW9kdWxlLmNvbnRleHQuZGlzcGF0Y2g7CiAgICAgIH0KCiAgICAgIHJldHVybiB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nID8gdmFsLmFwcGx5KHRoaXMsIFtkaXNwYXRjaF0uY29uY2F0KGFyZ3MpKSA6IGRpc3BhdGNoLmFwcGx5KHRoaXMuJHN0b3JlLCBbdmFsXS5jb25jYXQoYXJncykpOwogICAgfTsKICB9KTsKICByZXR1cm4gcmVzOwp9KTsKLyoqCiAqIFJlYmluZGluZyBuYW1lc3BhY2UgcGFyYW0gZm9yIG1hcFhYWCBmdW5jdGlvbiBpbiBzcGVjaWFsIHNjb3BlZCwgYW5kIHJldHVybiB0aGVtIGJ5IHNpbXBsZSBvYmplY3QKICogQHBhcmFtIHtTdHJpbmd9IG5hbWVzcGFjZQogKiBAcmV0dXJuIHtPYmplY3R9CiAqLwoKdmFyIGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzID0gZnVuY3Rpb24gY3JlYXRlTmFtZXNwYWNlZEhlbHBlcnMobmFtZXNwYWNlKSB7CiAgcmV0dXJuIHsKICAgIG1hcFN0YXRlOiBtYXBTdGF0ZS5iaW5kKG51bGwsIG5hbWVzcGFjZSksCiAgICBtYXBHZXR0ZXJzOiBtYXBHZXR0ZXJzLmJpbmQobnVsbCwgbmFtZXNwYWNlKSwKICAgIG1hcE11dGF0aW9uczogbWFwTXV0YXRpb25zLmJpbmQobnVsbCwgbmFtZXNwYWNlKSwKICAgIG1hcEFjdGlvbnM6IG1hcEFjdGlvbnMuYmluZChudWxsLCBuYW1lc3BhY2UpCiAgfTsKfTsKLyoqCiAqIE5vcm1hbGl6ZSB0aGUgbWFwCiAqIG5vcm1hbGl6ZU1hcChbMSwgMiwgM10pID0+IFsgeyBrZXk6IDEsIHZhbDogMSB9LCB7IGtleTogMiwgdmFsOiAyIH0sIHsga2V5OiAzLCB2YWw6IDMgfSBdCiAqIG5vcm1hbGl6ZU1hcCh7YTogMSwgYjogMiwgYzogM30pID0+IFsgeyBrZXk6ICdhJywgdmFsOiAxIH0sIHsga2V5OiAnYicsIHZhbDogMiB9LCB7IGtleTogJ2MnLCB2YWw6IDMgfSBdCiAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBtYXAKICogQHJldHVybiB7T2JqZWN0fQogKi8KCgpmdW5jdGlvbiBub3JtYWxpemVNYXAobWFwKSB7CiAgcmV0dXJuIEFycmF5LmlzQXJyYXkobWFwKSA/IG1hcC5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgcmV0dXJuIHsKICAgICAga2V5OiBrZXksCiAgICAgIHZhbDoga2V5CiAgICB9OwogIH0pIDogT2JqZWN0LmtleXMobWFwKS5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgcmV0dXJuIHsKICAgICAga2V5OiBrZXksCiAgICAgIHZhbDogbWFwW2tleV0KICAgIH07CiAgfSk7Cn0KLyoqCiAqIFJldHVybiBhIGZ1bmN0aW9uIGV4cGVjdCB0d28gcGFyYW0gY29udGFpbnMgbmFtZXNwYWNlIGFuZCBtYXAuIGl0IHdpbGwgbm9ybWFsaXplIHRoZSBuYW1lc3BhY2UgYW5kIHRoZW4gdGhlIHBhcmFtJ3MgZnVuY3Rpb24gd2lsbCBoYW5kbGUgdGhlIG5ldyBuYW1lc3BhY2UgYW5kIHRoZSBtYXAuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAqIEByZXR1cm4ge0Z1bmN0aW9ufQogKi8KCgpmdW5jdGlvbiBub3JtYWxpemVOYW1lc3BhY2UoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKG5hbWVzcGFjZSwgbWFwKSB7CiAgICBpZiAodHlwZW9mIG5hbWVzcGFjZSAhPT0gJ3N0cmluZycpIHsKICAgICAgbWFwID0gbmFtZXNwYWNlOwogICAgICBuYW1lc3BhY2UgPSAnJzsKICAgIH0gZWxzZSBpZiAobmFtZXNwYWNlLmNoYXJBdChuYW1lc3BhY2UubGVuZ3RoIC0gMSkgIT09ICcvJykgewogICAgICBuYW1lc3BhY2UgKz0gJy8nOwogICAgfQoKICAgIHJldHVybiBmbihuYW1lc3BhY2UsIG1hcCk7CiAgfTsKfQovKioKICogU2VhcmNoIGEgc3BlY2lhbCBtb2R1bGUgZnJvbSBzdG9yZSBieSBuYW1lc3BhY2UuIGlmIG1vZHVsZSBub3QgZXhpc3QsIHByaW50IGVycm9yIG1lc3NhZ2UuCiAqIEBwYXJhbSB7T2JqZWN0fSBzdG9yZQogKiBAcGFyYW0ge1N0cmluZ30gaGVscGVyCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lc3BhY2UKICogQHJldHVybiB7T2JqZWN0fQogKi8KCgpmdW5jdGlvbiBnZXRNb2R1bGVCeU5hbWVzcGFjZShzdG9yZSwgaGVscGVyLCBuYW1lc3BhY2UpIHsKICB2YXIgbW9kdWxlID0gc3RvcmUuX21vZHVsZXNOYW1lc3BhY2VNYXBbbmFtZXNwYWNlXTsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIW1vZHVsZSkgewogICAgY29uc29sZS5lcnJvcigiW3Z1ZXhdIG1vZHVsZSBuYW1lc3BhY2Ugbm90IGZvdW5kIGluICIgKyBoZWxwZXIgKyAiKCk6ICIgKyBuYW1lc3BhY2UpOwogIH0KCiAgcmV0dXJuIG1vZHVsZTsKfQoKdmFyIGluZGV4X2VzbSA9IHsKICBTdG9yZTogU3RvcmUsCiAgaW5zdGFsbDogaW5zdGFsbCwKICB2ZXJzaW9uOiAnMy4xLjAnLAogIG1hcFN0YXRlOiBtYXBTdGF0ZSwKICBtYXBNdXRhdGlvbnM6IG1hcE11dGF0aW9ucywKICBtYXBHZXR0ZXJzOiBtYXBHZXR0ZXJzLAogIG1hcEFjdGlvbnM6IG1hcEFjdGlvbnMsCiAgY3JlYXRlTmFtZXNwYWNlZEhlbHBlcnM6IGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzCn07CmV4cG9ydCBkZWZhdWx0IGluZGV4X2VzbTsKZXhwb3J0IHsgU3RvcmUsIGluc3RhbGwsIG1hcFN0YXRlLCBtYXBNdXRhdGlvbnMsIG1hcEdldHRlcnMsIG1hcEFjdGlvbnMsIGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzIH07"},null]}